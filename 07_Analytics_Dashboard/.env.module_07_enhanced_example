# ============================================================================
# Aigent Module 07 - Enhanced Analytics Dashboard
# Environment Variables Template
# Version: 1.1.0-enhanced
# PHI Level: NONE (Aggregated data only)
# ============================================================================
#
# ‚ö†Ô∏è SECURITY NOTE: This module aggregates data from all other modules
# Data is de-identified and aggregated - no individual PHI exposed
#
# INSTRUCTIONS:
# 1. Copy this file to your n8n environment configuration
# 2. Replace all placeholder values with your actual credentials/settings
# 3. NEVER commit the actual .env file to version control
# 4. Schedule analytics generation during off-peak hours
#
# ============================================================================

# ----------------------------------------------------------------------------
# SCHEDULING CONFIGURATION
# ----------------------------------------------------------------------------

# Schedule trigger (cron format)
# Examples:
# - Daily at 6 AM: 0 6 * * *
# - Weekly Monday at 8 AM: 0 8 * * 1
# - Monthly 1st at 9 AM: 0 9 1 * *
ANALYTICS_SCHEDULE=0 6 * * *

# Timezone for schedule
TIMEZONE=America/New_York

# Analytics reporting period
# Options: daily, weekly, monthly
REPORTING_PERIOD=daily

# Lookback period (days)
# For daily: 1, for weekly: 7, for monthly: 30
LOOKBACK_DAYS=1

# ----------------------------------------------------------------------------
# DATA SOURCE: HUBSPOT CRM
# ----------------------------------------------------------------------------

# HubSpot Credential ID
HUBSPOT_CREDENTIAL_ID=1

# HubSpot Credential Name
HUBSPOT_CREDENTIAL_NAME=HubSpot Production Account

# HubSpot data to fetch
FETCH_HUBSPOT_CONTACTS=true
FETCH_HUBSPOT_DEALS=true
FETCH_HUBSPOT_ENGAGEMENTS=true

# HubSpot properties to include (comma-separated)
HUBSPOT_CONTACT_PROPERTIES=email,firstname,lastname,phone,lead_source,lead_score,lifecyclestage,createdate

# HubSpot API timeout (milliseconds)
HUBSPOT_TIMEOUT_MS=15000

# HubSpot retry configuration
HUBSPOT_RETRY_COUNT=3
HUBSPOT_RETRY_DELAY_MS=1000

# ----------------------------------------------------------------------------
# DATA SOURCE: STRIPE PAYMENTS
# ----------------------------------------------------------------------------

# Stripe Credential ID
STRIPE_CREDENTIAL_ID=2

# Stripe Credential Name
STRIPE_CREDENTIAL_NAME=Stripe Production Account

# Fetch Stripe data
FETCH_STRIPE_CHARGES=true
FETCH_STRIPE_CUSTOMERS=true
FETCH_STRIPE_INVOICES=true

# Stripe API version
STRIPE_API_VERSION=2023-10-16

# Stripe API timeout (milliseconds)
STRIPE_TIMEOUT_MS=10000

# Stripe retry configuration
STRIPE_RETRY_COUNT=3
STRIPE_RETRY_DELAY_MS=1000

# ----------------------------------------------------------------------------
# DATA SOURCE: SQUARE PAYMENTS (Alternative)
# ----------------------------------------------------------------------------

# Square Credential ID (if using Square instead of Stripe)
# SQUARE_CREDENTIAL_ID=24

# Fetch Square data
# FETCH_SQUARE_PAYMENTS=true
# FETCH_SQUARE_CUSTOMERS=true

# ----------------------------------------------------------------------------
# DATA SOURCE: CAL.COM BOOKINGS
# ----------------------------------------------------------------------------

# Cal.com API Key
CALCOM_API_KEY=your-cal-api-key

# Cal.com API Base URL
CALCOM_API_BASE_URL=https://api.cal.com/v1

# Fetch bookings data
FETCH_CALCOM_BOOKINGS=true

# Cal.com API timeout (milliseconds)
CALCOM_TIMEOUT_MS=10000

# Cal.com retry configuration
CALCOM_RETRY_COUNT=2
CALCOM_RETRY_DELAY_MS=1000

# ----------------------------------------------------------------------------
# DATA SOURCE: TYPEFORM SURVEYS
# ----------------------------------------------------------------------------

# Typeform Credential ID
TYPEFORM_CREDENTIAL_ID=25

# Typeform Form IDs (comma-separated)
# Get form IDs from Typeform dashboard URL
TYPEFORM_FORM_IDS=abc123,def456

# Fetch Typeform responses
FETCH_TYPEFORM_RESPONSES=true

# Typeform API timeout (milliseconds)
TYPEFORM_TIMEOUT_MS=10000

# ----------------------------------------------------------------------------
# DATA SOURCE: GOOGLE SHEETS (Module Data Logs)
# ----------------------------------------------------------------------------

# Google Sheets Credential ID
GOOGLE_SHEETS_CREDENTIAL_ID=6

# Spreadsheet ID (from URL)
GOOGLE_SHEET_ID=your-spreadsheet-id

# Sheet tab names for each module
SHEET_TAB_LEADS=Leads
SHEET_TAB_BOOKINGS=Bookings
SHEET_TAB_TELEHEALTH=Telehealth Sessions
SHEET_TAB_PAYMENTS=Payments
SHEET_TAB_DOCUMENTS=Documents
SHEET_TAB_MESSAGES=Messages

# Fetch data from sheets
FETCH_SHEETS_DATA=true

# Google Sheets API timeout (milliseconds)
SHEETS_TIMEOUT_MS=10000

# ----------------------------------------------------------------------------
# KPI COMPUTATION SETTINGS
# ----------------------------------------------------------------------------

# Enable KPI computation
ENABLE_KPI_COMPUTATION=true

# Volume Metrics
COMPUTE_TOTAL_LEADS=true
COMPUTE_TOTAL_BOOKINGS=true
COMPUTE_TOTAL_SESSIONS=true
COMPUTE_TOTAL_REVENUE=true

# Conversion Metrics
COMPUTE_LEAD_TO_BOOKING_RATE=true
COMPUTE_BOOKING_SHOW_RATE=true
COMPUTE_BOOKING_TO_PAYMENT_RATE=true

# Patient Engagement Metrics
COMPUTE_UNIQUE_PATIENTS=true
COMPUTE_REPEAT_PATIENTS=true
COMPUTE_RETENTION_RATE=true
COMPUTE_AVG_SESSIONS_PER_PATIENT=true

# Revenue Metrics
COMPUTE_AVG_REVENUE_PER_PATIENT=true
COMPUTE_TOTAL_REFUNDS=true
COMPUTE_NET_REVENUE=true

# NPS (Net Promoter Score) Metrics
COMPUTE_NPS_SCORE=true
COMPUTE_NPS_DISTRIBUTION=true

# Response Time Metrics
COMPUTE_AVG_RESPONSE_TIME=true

# Source Attribution
COMPUTE_LEADS_BY_SOURCE=true
COMPUTE_REVENUE_BY_SOURCE=true

# Provider Performance (if multi-provider clinic)
COMPUTE_SESSIONS_BY_PROVIDER=true
COMPUTE_REVENUE_BY_PROVIDER=true

# ----------------------------------------------------------------------------
# REPORT GENERATION SETTINGS
# ----------------------------------------------------------------------------

# Enable HTML report generation
ENABLE_HTML_REPORT=true

# Report template
# Options: standard, executive, detailed
REPORT_TEMPLATE=standard

# Include charts in report
INCLUDE_CHARTS=true

# Chart library
# Options: chartjs, google_charts
CHART_LIBRARY=chartjs

# Report branding
CLINIC_NAME=Your Clinic Name
CLINIC_LOGO_URL=https://yourclinic.com/logo.png
BRAND_PRIMARY_COLOR=#4F46E5

# ----------------------------------------------------------------------------
# REPORT DISTRIBUTION
# ----------------------------------------------------------------------------

# Enable email delivery
ENABLE_EMAIL_DELIVERY=true

# SendGrid Credential ID
SENDGRID_CREDENTIAL_ID=11

# Email recipients (comma-separated)
REPORT_RECIPIENTS=admin@yourclinic.com,director@yourclinic.com

# Email from address
SENDGRID_FROM_EMAIL=analytics@yourclinic.com

# Email subject template
EMAIL_SUBJECT_TEMPLATE=üìä {{CLINIC_NAME}} Analytics Report - {{PERIOD}}

# Email retry configuration
EMAIL_RETRY_COUNT=2
EMAIL_RETRY_DELAY_MS=500

# Enable Slack delivery
ENABLE_SLACK_DELIVERY=true

# Slack webhook URL
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/T.../B.../XXX...

# Slack channel
SLACK_CHANNEL=#analytics

# Enable report storage (save to Google Drive/S3)
ENABLE_REPORT_STORAGE=true

# Storage backend
# Options: google_drive, s3
REPORT_STORAGE_BACKEND=google_drive

# Google Drive Configuration
GOOGLE_DRIVE_CREDENTIAL_ID=22
GOOGLE_DRIVE_FOLDER_ID=your-folder-id

# S3 Configuration (Alternative)
# AWS_CREDENTIAL_ID=17
# S3_REPORT_BUCKET=aigent-reports
# S3_REPORT_PREFIX=analytics/

# ----------------------------------------------------------------------------
# ALERT THRESHOLDS
# ----------------------------------------------------------------------------

# Enable performance alerts
ENABLE_PERFORMANCE_ALERTS=true

# Lead volume alert
# Alert if daily leads drop below threshold
LEAD_VOLUME_THRESHOLD=10
ALERT_ON_LOW_LEADS=true

# Conversion rate alert
# Alert if lead-to-booking rate drops below threshold
LEAD_TO_BOOKING_THRESHOLD=0.30
ALERT_ON_LOW_CONVERSION=true

# Show rate alert
# Alert if booking show rate drops below threshold
SHOW_RATE_THRESHOLD=0.75
ALERT_ON_LOW_SHOW_RATE=true

# Revenue alert
# Alert if daily revenue drops below threshold (cents)
REVENUE_THRESHOLD_CENTS=50000
ALERT_ON_LOW_REVENUE=true

# NPS alert
# Alert if NPS score drops below threshold
NPS_THRESHOLD=7.0
ALERT_ON_LOW_NPS=true

# Alert recipients
ALERT_EMAIL=alerts@yourclinic.com
ALERT_SLACK_WEBHOOK=https://hooks.slack.com/services/T.../B.../XXX...

# ----------------------------------------------------------------------------
# DATA QUALITY & VALIDATION
# ----------------------------------------------------------------------------

# Enable data quality checks
ENABLE_DATA_QUALITY_CHECKS=true

# Confidence thresholds
# Minimum number of data points for reliable metrics
MIN_LEADS_FOR_CONFIDENCE=5
MIN_BOOKINGS_FOR_CONFIDENCE=3
MIN_PAYMENTS_FOR_CONFIDENCE=2

# Data freshness check
# Alert if data sources haven't been updated recently
MAX_DATA_AGE_HOURS=48

# Missing data handling
# Options: zero, null, skip, interpolate
MISSING_DATA_STRATEGY=zero

# Outlier detection
# Flag data points beyond N standard deviations
OUTLIER_DETECTION_ENABLED=true
OUTLIER_SIGMA_THRESHOLD=3.0

# ----------------------------------------------------------------------------
# PERFORMANCE TUNING
# ----------------------------------------------------------------------------

# Workflow execution timeout (milliseconds)
# Analytics can process large datasets
WORKFLOW_TIMEOUT_MS=300000

# Maximum parallel executions
# Analytics should not run concurrently (data consistency)
MAX_PARALLEL_EXECUTIONS=1

# Data source parallel fetching
# Fetch from multiple sources simultaneously
ENABLE_PARALLEL_FETCH=true

# Cache analytics data
# Avoid re-fetching if report requested multiple times same day
ENABLE_ANALYTICS_CACHE=true
CACHE_TTL_HOURS=12

# Target execution time (milliseconds)
# Module 07 target: <60000ms (1 minute)
TARGET_EXECUTION_TIME_MS=60000

# ----------------------------------------------------------------------------
# OBSERVABILITY & MONITORING
# ----------------------------------------------------------------------------

# Enable debug mode
DEBUG_MODE=false

# Save execution data
SAVE_EXECUTION_DATA=all

# Support email
SUPPORT_EMAIL=support@yourclinic.com

# Workflow version
WORKFLOW_VERSION=1.1.0-enhanced

# Enable performance tracking
ENABLE_PERFORMANCE_TRACKING=true

# Enable audit logging
AUDIT_LOG_ENABLED=true

# Module 09 (Audit) webhook URL
MODULE_09_AUDIT_WEBHOOK_URL=https://n8n.yourclinic.com/webhook/aigent-audit-log

# ----------------------------------------------------------------------------
# INTEGRATION WITH OTHER MODULES
# ----------------------------------------------------------------------------

# Module 01 (Leads) - data source
MODULE_01_DATA_SOURCE=hubspot

# Module 02 (Bookings) - data source
MODULE_02_DATA_SOURCE=calcom

# Module 03 (Telehealth) - data source
MODULE_03_DATA_SOURCE=sheets

# Module 04 (Payments) - data source
MODULE_04_DATA_SOURCE=stripe

# Module 05 (Followup) - data source
MODULE_05_DATA_SOURCE=sheets

# Module 06 (Documents) - data source
MODULE_06_DATA_SOURCE=sheets

# Module 08 (Messaging) - data source
MODULE_08_DATA_SOURCE=sheets

# ----------------------------------------------------------------------------
# ADVANCED FEATURES (Optional)
# ----------------------------------------------------------------------------

# Enable predictive analytics
# Forecast future metrics using time-series analysis
ENABLE_PREDICTIVE_ANALYTICS=false

# Prediction horizon (days)
# PREDICTION_HORIZON_DAYS=7

# Enable cohort analysis
# Track patient cohorts over time
ENABLE_COHORT_ANALYSIS=false

# Enable A/B test tracking
# Compare performance across campaigns/providers
ENABLE_AB_TEST_TRACKING=false

# Enable custom metrics
# Define custom KPIs via JavaScript expressions
ENABLE_CUSTOM_METRICS=false

# Custom metric definitions (JSON format)
# CUSTOM_METRICS=[{"name":"avg_session_duration","formula":"sum(session_durations)/count(sessions)"}]

# ============================================================================
# END OF CONFIGURATION
# ============================================================================
#
# SETUP CHECKLIST:
# [ ] All data source credentials configured (HubSpot, Stripe, Cal.com, etc.)
# [ ] Schedule configured (ANALYTICS_SCHEDULE cron expression)
# [ ] Timezone set correctly (TIMEZONE)
# [ ] Report recipients configured (email, Slack)
# [ ] Branding configured (CLINIC_NAME, CLINIC_LOGO_URL, colors)
# [ ] Alert thresholds configured
# [ ] Data quality thresholds set (MIN_LEADS_FOR_CONFIDENCE, etc.)
# [ ] Report storage configured (Google Drive or S3)
# [ ] Performance settings tuned (timeouts, parallel fetch)
#
# TESTING CHECKLIST:
# [ ] Test data source connections (HubSpot, Stripe, Cal.com, Sheets)
# [ ] Test KPI computation (manual verification of calculations)
# [ ] Test report generation (HTML format, charts)
# [ ] Test email delivery (verify recipients receive report)
# [ ] Test Slack delivery (verify message posted to channel)
# [ ] Test alert triggers (simulate low performance metrics)
# [ ] Test with missing data (verify graceful handling)
# [ ] Test with outlier data (verify detection and flagging)
# [ ] Test report storage (verify file saved to Drive/S3)
# [ ] Test different reporting periods (daily, weekly, monthly)
# [ ] Verify no PHI in reports (aggregated data only)
# [ ] Test execution time (should complete within 60 seconds)
#
# MONITORING CHECKLIST:
# [ ] Monitor analytics schedule execution (daily at 6 AM)
# [ ] Monitor data source fetch success rate (>95%)
# [ ] Monitor report generation success rate (>99%)
# [ ] Monitor email/Slack delivery success
# [ ] Monitor execution time (<60000ms)
# [ ] Review alert triggers (false positives/negatives)
# [ ] Track data freshness (MAX_DATA_AGE_HOURS)
# [ ] Monitor storage usage (Drive/S3 reports)
# [ ] Review KPI trends weekly
# [ ] Validate KPI accuracy monthly (spot check calculations)
#
# OPERATIONAL CHECKLIST:
# [ ] Schedule weekly analytics review meeting
# [ ] Document KPI definitions (how each metric is calculated)
# [ ] Establish alert response procedures
# [ ] Train staff on report interpretation
# [ ] Review and adjust alert thresholds quarterly
# [ ] Archive old reports (retention policy)
# [ ] Monitor data source API rate limits
# [ ] Update report recipients as staff changes
#
# For support: support@aigent.company
# Documentation: https://docs.aigent.company/templates/module-07-enhanced
# ============================================================================
