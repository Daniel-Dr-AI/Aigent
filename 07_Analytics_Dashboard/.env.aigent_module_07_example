# ============================================================
# AIGENT MODULE 07 - ANALYTICS & REPORTING DASHBOARD
# Environment Configuration Template
# ============================================================
# Version: 1.0.0
# Last Updated: 2025-01-15
# Purpose: Aggregate metrics from all modules, compute KPIs, generate reports
# ============================================================

# ------------------------------------------------------------
# SCHEDULING CONFIGURATION
# ------------------------------------------------------------
# CRON schedule for automated analytics runs
# Format: minute hour day month weekday
# Examples:
#   0 6 * * *     = Daily at 6 AM
#   0 6 * * 1     = Every Monday at 6 AM
#   0 */6 * * *   = Every 6 hours
ANALYTICS_SCHEDULE=0 6 * * *

# Reporting period (days to look back)
REPORT_PERIOD_DAYS=30

# Report generation timezone
REPORT_TIMEZONE=America/New_York

# ------------------------------------------------------------
# REPORT CONFIGURATION
# ------------------------------------------------------------
# Report format: html, markdown, json
REPORT_FORMAT=html

# Brand/Clinic name (appears in report header)
BRAND_NAME=Your Clinic

# Primary data store: sheets, bigquery, airtable
PRIMARY_DATA_STORE=sheets

# Report file naming pattern
REPORT_FILENAME_PATTERN=${BRAND_NAME}_report_${DATE}.html

# ------------------------------------------------------------
# DATA SOURCE: CRM (LEADS)
# ------------------------------------------------------------
# CRM Provider: hubspot, salesforce, zoho, sheets
CRM_PROVIDER=hubspot

# HubSpot Configuration
HUBSPOT_API_KEY=pat-na1-your-private-app-token
HUBSPOT_CREDENTIAL_ID=your_hubspot_credential_id

# Salesforce Configuration
SALESFORCE_CREDENTIAL_ID=your_salesforce_credential_id
SALESFORCE_INSTANCE_URL=https://yourinstance.salesforce.com

# Zoho CRM Configuration
ZOHO_CREDENTIAL_ID=your_zoho_credential_id
ZOHO_API_DOMAIN=https://www.zohoapis.com

# ------------------------------------------------------------
# DATA SOURCE: BOOKING SYSTEMS
# ------------------------------------------------------------
# Booking Provider: calcom, acuity, simplybook, sheets
BOOKING_PROVIDER=calcom

# Cal.com Configuration
CALCOM_TOKEN=your_calcom_api_key
CALCOM_API_BASE=https://api.cal.com

# Acuity Scheduling Configuration
ACUITY_USER_ID=your_user_id
ACUITY_API_KEY=your_api_key
ACUITY_BASE_URL=https://acuityscheduling.com/api/v1

# SimplyBook.me Configuration
SIMPLYBOOK_COMPANY=your_company
SIMPLYBOOK_API_KEY=your_api_key

# ------------------------------------------------------------
# DATA SOURCE: PAYMENT GATEWAYS
# ------------------------------------------------------------
# Payment Provider: stripe, square, quickbooks, sheets
PAYMENT_PROVIDER=stripe

# Stripe Configuration
STRIPE_API_KEY=sk_live_your_stripe_secret_key
STRIPE_CREDENTIAL_ID=your_stripe_credential_id

# Square Configuration
SQUARE_ACCESS_TOKEN=your_square_access_token
SQUARE_LOCATION_ID=your_location_id

# QuickBooks Configuration
QUICKBOOKS_CLIENT_ID=your_client_id
QUICKBOOKS_CLIENT_SECRET=your_client_secret
QUICKBOOKS_REALM_ID=your_realm_id
QUICKBOOKS_REFRESH_TOKEN=your_refresh_token

# ------------------------------------------------------------
# DATA SOURCE: SURVEY / NPS
# ------------------------------------------------------------
# Survey Provider: typeform, google_forms, surveymonkey, sheets
SURVEY_PROVIDER=typeform

# Typeform Configuration
TYPEFORM_TOKEN=tfp_your_typeform_api_key
TYPEFORM_FORM_ID=your_form_id

# SurveyMonkey Configuration
SURVEYMONKEY_ACCESS_TOKEN=your_access_token
SURVEYMONKEY_SURVEY_ID=your_survey_id

# Google Forms Configuration (via Sheets responses)
GFORMS_SHEET_ID=your_form_responses_sheet_id

# ------------------------------------------------------------
# DATA SOURCE: GOOGLE SHEETS (FALLBACK/PRIMARY)
# ------------------------------------------------------------
# Google Sheets Credential
GOOGLE_SHEETS_CREDENTIAL_ID=your_gsheet_credential_id

# Main Google Sheet ID (contains all data tabs)
GOOGLE_SHEET_ID=1aBcDeFgHiJkLmNoPqRsTuVwXyZ123456789

# Sheet tab names for each data source
SHEET_LEADS_TAB=Leads
SHEET_BOOKINGS_TAB=Bookings
SHEET_PAYMENTS_TAB=Payments
SHEET_SURVEYS_TAB=Survey_Responses
SHEET_OCR_TAB=OCR_Log
SHEET_ANALYTICS_TAB=Analytics_Summary

# ------------------------------------------------------------
# DATA SOURCE: AIRTABLE (ALTERNATIVE)
# ------------------------------------------------------------
# Airtable Configuration
AIRTABLE_API_KEY=keyXXXXXXXXXXXXXX
AIRTABLE_BASE_ID=appXXXXXXXXXXXXXX
AIRTABLE_CREDENTIAL_ID=your_airtable_credential_id

# Airtable table names
AIRTABLE_LEADS_TABLE=Leads
AIRTABLE_BOOKINGS_TABLE=Bookings
AIRTABLE_PAYMENTS_TABLE=Payments
AIRTABLE_NPS_TABLE=NPS_Responses

# ------------------------------------------------------------
# STORAGE: REPORT OUTPUT
# ------------------------------------------------------------
# Storage provider: s3, gdrive, local
STORAGE_PROVIDER=s3

# AWS S3 Configuration
S3_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
S3_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
S3_REGION=us-east-1
S3_BUCKET=clinic-reports
S3_PREFIX=analytics/
AWS_CREDENTIAL_ID=your_aws_credential_id

# Google Drive Configuration
DRIVE_CREDENTIAL_ID=your_gdrive_credential_id
DRIVE_FOLDER_ID=1aBcDeFgHiJkLmNoPqRsTuVwXyZ
DRIVE_FOLDER_NAME=Analytics Reports

# Local storage path (if STORAGE_PROVIDER=local)
LOCAL_REPORT_PATH=/var/reports/

# ------------------------------------------------------------
# EMAIL DISTRIBUTION
# ------------------------------------------------------------
# Enable email report distribution
EMAIL_REPORT_ENABLED=true

# Email recipients (comma-separated)
EMAIL_REPORT_TO=admin@yourclinic.com,manager@yourclinic.com

# Email sender
EMAIL_FROM=noreply@yourclinic.com
EMAIL_FROM_NAME=Aigent Analytics

# SMTP Configuration
SMTP_CREDENTIAL_ID=your_smtp_credential_id
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASSWORD=your_app_password

# Email subject template
EMAIL_SUBJECT_TEMPLATE=${BRAND_NAME} Analytics Report - ${DATE}

# ------------------------------------------------------------
# VISUALIZATION: LOOKER STUDIO
# ------------------------------------------------------------
# Enable Looker Studio export
LOOKER_EXPORT_ENABLED=false

# Looker Studio dashboard URL
LOOKER_STUDIO_URL=https://lookerstudio.google.com/reporting/your-dashboard-id

# Looker Studio data source ID
LOOKER_DATA_SOURCE_ID=your_data_source_id

# ------------------------------------------------------------
# VISUALIZATION: POWER BI (ALTERNATIVE)
# ------------------------------------------------------------
# Enable Power BI export
POWERBI_EXPORT_ENABLED=false

# Power BI Configuration
POWERBI_WORKSPACE_ID=your_workspace_id
POWERBI_DATASET_ID=your_dataset_id
POWERBI_CLIENT_ID=your_client_id
POWERBI_CLIENT_SECRET=your_client_secret
POWERBI_TENANT_ID=your_tenant_id

# ------------------------------------------------------------
# VISUALIZATION: TABLEAU (ALTERNATIVE)
# ------------------------------------------------------------
# Enable Tableau export
TABLEAU_EXPORT_ENABLED=false

# Tableau Configuration
TABLEAU_SITE_URL=https://your-site.tableau.com
TABLEAU_USERNAME=your_username
TABLEAU_PASSWORD=your_password
TABLEAU_SITE_ID=your_site_id

# ------------------------------------------------------------
# KPI CONFIGURATION
# ------------------------------------------------------------
# Minimum confidence filter for OCR metrics (0.0 - 1.0)
MIN_CONFIDENCE_FILTER=0.8

# NPS calculation method: average or net_score
NPS_CALCULATION_METHOD=net_score

# Revenue currency
REVENUE_CURRENCY=USD

# Conversion rate targets (for color coding in reports)
TARGET_LEAD_TO_BOOKING=0.60
TARGET_BOOKING_TO_VISIT=0.80
TARGET_SHOW_RATE=0.85
TARGET_RETENTION_RATE=0.70

# NPS targets
TARGET_NPS_AVG=8.0
TARGET_NPS_NET_SCORE=50

# ------------------------------------------------------------
# DATA FILTERING & PROCESSING
# ------------------------------------------------------------
# Exclude test/demo data
EXCLUDE_TEST_DATA=true
TEST_EMAIL_PATTERNS=test@,demo@,example@

# Deduplication strategy: email, patient_id, both
DEDUPLICATION_STRATEGY=email

# Handle missing data: ignore, zero, interpolate
MISSING_DATA_STRATEGY=ignore

# Date range validation
VALIDATE_DATE_RANGES=true

# ------------------------------------------------------------
# ADVANCED: BIGQUERY (OPTIONAL)
# ------------------------------------------------------------
# Enable BigQuery export for advanced analytics
BIGQUERY_EXPORT_ENABLED=false

# BigQuery Configuration
BIGQUERY_PROJECT_ID=your-gcp-project-id
BIGQUERY_DATASET_ID=clinic_analytics
BIGQUERY_TABLE_ID=daily_metrics
BIGQUERY_CREDENTIAL_ID=your_bigquery_credential_id

# BigQuery partitioning
BIGQUERY_PARTITION_FIELD=date
BIGQUERY_PARTITION_TYPE=DAY

# ------------------------------------------------------------
# SECURITY & COMPLIANCE
# ------------------------------------------------------------
# CORS allowed origins for webhook triggers
ALLOWED_ORIGINS=*

# PHI-safe mode (excludes identifiable patient data from reports)
PHI_SAFE_MODE=true

# Data retention for analytics summaries (days)
ANALYTICS_RETENTION_DAYS=730

# Audit logging
AUDIT_LOG_ENABLED=true

# ------------------------------------------------------------
# ERROR HANDLING & DEBUGGING
# ------------------------------------------------------------
# Debug mode (verbose logging)
DEBUG_MODE=false

# Continue on data source failures
CONTINUE_ON_SOURCE_FAILURE=true

# Error workflow ID (n8n workflow to handle failures)
ERROR_WORKFLOW_ID=

# Retry configuration
MAX_RETRIES=3
RETRY_DELAY_MS=1000

# ------------------------------------------------------------
# WEBHOOKS & API TRIGGERS
# ------------------------------------------------------------
# Enable webhook trigger for manual analytics runs
WEBHOOK_TRIGGER_ENABLED=true
WEBHOOK_ID_MODULE_07=your_webhook_id_here

# API authentication for webhook
WEBHOOK_API_KEY=your_secure_api_key

# ------------------------------------------------------------
# NOTIFICATION CHANNELS (OPTIONAL)
# ------------------------------------------------------------
# Slack notifications for completed reports
SLACK_NOTIFICATION_ENABLED=false
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL
SLACK_CHANNEL=#analytics

# Microsoft Teams notifications
TEAMS_NOTIFICATION_ENABLED=false
TEAMS_WEBHOOK_URL=https://outlook.office.com/webhook/YOUR_WEBHOOK_URL

# ------------------------------------------------------------
# CUSTOM METRICS (OPTIONAL)
# ------------------------------------------------------------
# Enable custom metric calculations
CUSTOM_METRICS_ENABLED=false

# Custom metric formulas (JavaScript expressions)
CUSTOM_METRIC_1_NAME=Patient Lifetime Value
CUSTOM_METRIC_1_FORMULA=total_revenue / unique_patients

CUSTOM_METRIC_2_NAME=Cost Per Acquisition
CUSTOM_METRIC_2_FORMULA=marketing_spend / total_leads

# Marketing spend (for CPA calculation)
MARKETING_SPEND_USD=5000

# ------------------------------------------------------------
# REPORT CUSTOMIZATION
# ------------------------------------------------------------
# Include sections in HTML report
INCLUDE_VOLUME_METRICS=true
INCLUDE_CONVERSION_FUNNEL=true
INCLUDE_REVENUE_METRICS=true
INCLUDE_NPS_ANALYSIS=true
INCLUDE_OCR_METRICS=true
INCLUDE_PATIENT_ENGAGEMENT=true

# Chart generation (requires external service)
GENERATE_CHARTS=false
CHART_SERVICE_URL=https://quickchart.io/chart

# Color scheme: default, blue, purple, green
REPORT_COLOR_SCHEME=purple

# Logo URL (appears in report header)
CLINIC_LOGO_URL=https://yourclinic.com/logo.png

# ------------------------------------------------------------
# PERFORMANCE TUNING
# ------------------------------------------------------------
# API request timeout (milliseconds)
API_TIMEOUT_MS=30000

# Maximum records to fetch per source
MAX_RECORDS_PER_SOURCE=10000

# Parallel data collection (faster but more resource-intensive)
ENABLE_PARALLEL_COLLECTION=true

# Cache duration for data sources (seconds)
CACHE_DURATION_SEC=3600

# ------------------------------------------------------------
# TESTING & DEVELOPMENT
# ------------------------------------------------------------
# Test mode: use sample data instead of real APIs
TEST_MODE=false

# Sample data file path
SAMPLE_DATA_PATH=/data/sample_analytics.json

# Mock API responses
MOCK_HUBSPOT=false
MOCK_STRIPE=false
MOCK_TYPEFORM=false

# ------------------------------------------------------------
# MODULE CHAINING
# ------------------------------------------------------------
# Accept real-time data from upstream modules
ACCEPT_UPSTREAM_REALTIME=true

# Webhook endpoints from other modules
MODULE_01_WEBHOOK=https://n8n.instance.com/webhook/aigent-intake
MODULE_04_WEBHOOK=https://n8n.instance.com/webhook/aigent-billing
MODULE_05_WEBHOOK=https://n8n.instance.com/webhook/aigent-followup
MODULE_06_WEBHOOK=https://n8n.instance.com/webhook/aigent-document-capture

# Output for downstream compliance/management modules
OUTPUT_FOR_COMPLIANCE=true
OUTPUT_FOR_MANAGER=true

# ------------------------------------------------------------
# NOTES
# ------------------------------------------------------------
# 1. All credentials should be stored in n8n's credential manager
#    Reference them using: {{$env.CREDENTIAL_ID}}
#
# 2. CRON Schedule Format:
#    ┌───────────── minute (0 - 59)
#    │ ┌───────────── hour (0 - 23)
#    │ │ ┌───────────── day of month (1 - 31)
#    │ │ │ ┌───────────── month (1 - 12)
#    │ │ │ │ ┌───────────── day of week (0 - 6) (Sunday=0)
#    │ │ │ │ │
#    * * * * *
#
# 3. Reporting Period:
#    - 7 days = weekly report
#    - 30 days = monthly report
#    - 90 days = quarterly report
#
# 4. Data Sources Priority:
#    If multiple sources configured, workflow tries:
#    1. Primary API (HubSpot, Stripe, etc.)
#    2. Fallback to Google Sheets
#    3. Continue with available data if source fails
#
# 5. KPI Calculations:
#    - Lead to Booking: bookings / leads
#    - Booking to Visit: completed_visits / bookings
#    - Show Rate: 1 - (no_shows / bookings)
#    - Retention Rate: repeat_patients / unique_patients
#    - NPS Net Score: (promoters - detractors) / total * 100
#
# 6. Report Distribution:
#    - S3/Drive: Permanent storage with versioning
#    - Email: Immediate delivery to stakeholders
#    - Looker/Power BI: Live dashboard integration
#
# 7. PHI-Safe Mode:
#    When enabled, reports exclude:
#    - Individual patient names
#    - Email addresses
#    - Phone numbers
#    Only aggregate metrics are included
#
# 8. Test your workflow with TEST_MODE=true before production
#
# 9. For real-time analytics, enable ACCEPT_UPSTREAM_REALTIME
#    and configure webhook endpoints from other modules
#
# 10. BigQuery integration recommended for large-scale
#     analytics (>1000 patients, >10000 visits/month)
#
# ============================================================
