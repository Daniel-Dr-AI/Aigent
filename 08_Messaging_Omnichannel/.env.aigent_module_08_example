# ============================================================
# AIGENT MODULE 08 - MESSAGING & OMNICHANNEL HUB
# Environment Configuration Template
# ============================================================
# Version: 1.0.0
# Last Updated: 2025-01-15
# Purpose: Unified messaging hub for SMS, WhatsApp, Email, Telegram, Webchat
# ============================================================

# ------------------------------------------------------------
# WEBHOOK CONFIGURATION
# ------------------------------------------------------------
WEBHOOK_ID_MODULE_08=your_webhook_id_here
ALLOWED_ORIGINS=*

# ------------------------------------------------------------
# BUSINESS HOURS
# ------------------------------------------------------------
# Business hours (24-hour format)
BUSINESS_HOURS_START=8
BUSINESS_HOURS_END=18

# Business days (0=Sunday, 1=Monday, ..., 6=Saturday)
BUSINESS_DAYS=1,2,3,4,5

# Timezone
TIMEZONE=America/New_York

# ------------------------------------------------------------
# TWILIO CONFIGURATION (SMS & WHATSAPP)
# ------------------------------------------------------------
# Twilio Account SID and Auth Token
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=your_auth_token_here
TWILIO_CREDENTIAL_ID=your_twilio_credential_id

# SMS Configuration
TWILIO_FROM_NUMBER=+15551234567

# WhatsApp Configuration
TWILIO_WHATSAPP_NUMBER=+14155238886
TWILIO_WHATSAPP_ENABLED=true

# Twilio webhook URLs (for receiving messages)
TWILIO_SMS_WEBHOOK=https://your-n8n-instance.com/webhook/aigent-message-hub
TWILIO_WHATSAPP_WEBHOOK=https://your-n8n-instance.com/webhook/aigent-message-hub

# ------------------------------------------------------------
# EMAIL CONFIGURATION
# ------------------------------------------------------------
# SMTP for outbound email
SMTP_CREDENTIAL_ID=your_smtp_credential_id
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASSWORD=your_app_password
SMTP_SECURE=true

# Email addresses
EMAIL_FROM=noreply@yourclinic.com
EMAIL_FROM_NAME=Your Clinic

# SendGrid Inbound Parse (for receiving emails)
SENDGRID_INBOUND_ENABLED=true
SENDGRID_INBOUND_DOMAIN=inbound.yourclinic.com
SENDGRID_INBOUND_WEBHOOK=https://your-n8n-instance.com/webhook/aigent-message-hub

# ------------------------------------------------------------
# TELEGRAM CONFIGURATION (OPTIONAL)
# ------------------------------------------------------------
# Enable Telegram bot
TELEGRAM_ENABLED=false

# Telegram Bot Token (from @BotFather)
TELEGRAM_BOT_TOKEN=123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11
TELEGRAM_BOT_USERNAME=YourClinicBot

# Telegram webhook
TELEGRAM_WEBHOOK=https://your-n8n-instance.com/webhook/aigent-message-hub

# ------------------------------------------------------------
# WEBCHAT CONFIGURATION (OPTIONAL)
# ------------------------------------------------------------
# Enable webchat integration
WEBCHAT_ENABLED=false

# Webchat widget settings
WEBCHAT_WIDGET_ID=your_widget_id
WEBCHAT_API_KEY=your_webchat_api_key

# Webchat provider: custom, intercom, drift, livechat
WEBCHAT_PROVIDER=custom

# ------------------------------------------------------------
# AIGENT BOT CONFIGURATION
# ------------------------------------------------------------
# Enable AI-powered response bot
AIGENT_BOT_ENABLED=true

# AIgent Bot API endpoint
AIGENT_BOT_ENDPOINT=https://api.aigent.com/v1/chat
AIGENT_BOT_API_KEY=your_aigent_api_key

# Bot confidence threshold (0.0 - 1.0)
# Responses below this threshold require human review
AIGENT_BOT_CONFIDENCE_THRESHOLD=0.8

# Bot capabilities
AIGENT_BOT_CAN_BOOK=true
AIGENT_BOT_CAN_RESCHEDULE=true
AIGENT_BOT_CAN_ANSWER_FAQ=true
AIGENT_BOT_CAN_ACCESS_RECORDS=false

# ------------------------------------------------------------
# CRM INTEGRATION
# ------------------------------------------------------------
# CRM Provider: hubspot, salesforce, zoho
CRM_PROVIDER=hubspot

# HubSpot Configuration
HUBSPOT_API_KEY=pat-na1-your-private-app-token
HUBSPOT_CREDENTIAL_ID=your_hubspot_credential_id

# Salesforce Configuration
SALESFORCE_CREDENTIAL_ID=your_salesforce_credential_id
SALESFORCE_INSTANCE_URL=https://yourinstance.salesforce.com

# Zoho CRM Configuration
ZOHO_CREDENTIAL_ID=your_zoho_credential_id

# CRM custom fields for messaging
CRM_FIELD_LAST_MESSAGE_DATE=last_message_date
CRM_FIELD_LAST_MESSAGE_CHANNEL=last_message_channel
CRM_FIELD_LAST_MESSAGE_CONTENT=last_message_content
CRM_FIELD_TOTAL_MESSAGES=total_messages

# ------------------------------------------------------------
# MESSAGE LOGGING
# ------------------------------------------------------------
# Primary log storage: sheets, airtable, postgres, mongodb
LOG_STORAGE=sheets

# Google Sheets Configuration
GOOGLE_SHEETS_CREDENTIAL_ID=your_gsheet_credential_id
GOOGLE_SHEET_ID=1aBcDeFgHiJkLmNoPqRsTuVwXyZ123456789
SHEET_MESSAGES_TAB=Messages

# Airtable Configuration (alternative)
AIRTABLE_API_KEY=keyXXXXXXXXXXXXXX
AIRTABLE_BASE_ID=appXXXXXXXXXXXXXX
AIRTABLE_TABLE=Messages
AIRTABLE_CREDENTIAL_ID=your_airtable_credential_id

# PostgreSQL Configuration (alternative)
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DATABASE=clinic_db
POSTGRES_USER=n8n_user
POSTGRES_PASSWORD=your_password
POSTGRES_TABLE=messages

# ------------------------------------------------------------
# STAFF NOTIFICATIONS
# ------------------------------------------------------------
# Enable staff notifications
STAFF_NOTIFICATION_ENABLED=true

# Notification channel: slack, teams, email
NOTIFICATION_CHANNEL=slack

# Slack Configuration
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL
SLACK_MESSAGES_CHANNEL=#messages
SLACK_URGENT_CHANNEL=#urgent

# Microsoft Teams Configuration
TEAMS_WEBHOOK_URL=https://outlook.office.com/webhook/YOUR_WEBHOOK_URL

# Email notification
STAFF_EMAIL=staff@yourclinic.com

# Staff dashboard URL (for replying to messages)
STAFF_DASHBOARD_URL=https://dashboard.yourclinic.com/messages

# ------------------------------------------------------------
# MESSAGE ROUTING RULES
# ------------------------------------------------------------
# Route urgent messages immediately to staff
ROUTE_URGENT_TO_STAFF=true

# Route after-hours messages to auto-response
ROUTE_AFTER_HOURS_AUTO=true

# Route known contacts to bot first
ROUTE_KNOWN_TO_BOT=true

# Route new contacts to staff
ROUTE_NEW_TO_STAFF=false

# Keywords that trigger urgent routing (comma-separated)
URGENT_KEYWORDS=emergency,urgent,asap,pain,severe,help,911

# Keywords for booking intent (comma-separated)
BOOKING_KEYWORDS=appointment,schedule,reschedule,book,cancel,change time

# Keywords for billing intent (comma-separated)
BILLING_KEYWORDS=payment,bill,invoice,charge,cost,price

# ------------------------------------------------------------
# AUTO-RESPONSE TEMPLATES
# ------------------------------------------------------------
# Clinic branding
BRAND_NAME=Your Clinic

# After-hours auto-response
AFTER_HOURS_MESSAGE=Thank you for contacting ${BRAND_NAME}. Our office hours are ${BUSINESS_HOURS_START} AM - ${BUSINESS_HOURS_END} PM, Monday-Friday. We'll respond to your message during business hours. For medical emergencies, please call 911.

# Default auto-response (bot disabled)
DEFAULT_AUTO_RESPONSE=Thank you for contacting ${BRAND_NAME}. A team member will respond to your message shortly.

# Urgent message acknowledgment
URGENT_AUTO_RESPONSE=We've received your urgent message and are notifying our team immediately. For life-threatening emergencies, please call 911 or go to the nearest emergency room.

# New contact welcome message
NEW_CONTACT_WELCOME=Thank you for contacting ${BRAND_NAME}! A team member will be with you shortly.

# ------------------------------------------------------------
# MESSAGE CLASSIFICATION
# ------------------------------------------------------------
# Enable intent classification
CLASSIFY_INTENT=true

# Enable sentiment analysis
CLASSIFY_SENTIMENT=false

# Enable language detection
DETECT_LANGUAGE=false

# Supported languages (ISO 639-1 codes)
SUPPORTED_LANGUAGES=en,es,fr

# Default language
DEFAULT_LANGUAGE=en

# ------------------------------------------------------------
# SECURITY & FILTERING
# ------------------------------------------------------------
# Test message filtering
FILTER_TEST_MESSAGES=true
TEST_PHONE_PATTERN=^\\+1555

# Spam filtering
ENABLE_SPAM_FILTER=true
SPAM_KEYWORDS=viagra,casino,lottery,winner,claim prize

# Rate limiting (messages per contact per hour)
RATE_LIMIT_ENABLED=true
RATE_LIMIT_MAX_PER_HOUR=10

# Block list (comma-separated phone numbers or emails)
BLOCK_LIST=

# ------------------------------------------------------------
# ATTACHMENTS HANDLING
# ------------------------------------------------------------
# Enable attachment processing
PROCESS_ATTACHMENTS=true

# Max attachment size (MB)
MAX_ATTACHMENT_SIZE_MB=10

# Allowed attachment MIME types
ALLOWED_ATTACHMENT_TYPES=image/jpeg,image/png,application/pdf

# Attachment storage: s3, gdrive, local
ATTACHMENT_STORAGE=s3

# S3 Configuration (for attachments)
S3_BUCKET=clinic-message-attachments
S3_REGION=us-east-1
S3_ACCESS_KEY_ID=your_access_key
S3_SECRET_ACCESS_KEY=your_secret_key

# Google Drive Configuration (alternative)
GDRIVE_FOLDER_ID=your_folder_id

# ------------------------------------------------------------
# THREADING & CONVERSATION TRACKING
# ------------------------------------------------------------
# Enable conversation threading
ENABLE_THREADING=true

# Thread timeout (hours)
# Messages from same contact within this time are grouped
THREAD_TIMEOUT_HOURS=24

# Store conversation context
STORE_CONVERSATION_CONTEXT=true

# Max messages in context window
CONTEXT_WINDOW_SIZE=10

# ------------------------------------------------------------
# COMPLIANCE & PHI
# ------------------------------------------------------------
# PHI-safe mode (avoid logging sensitive medical info)
PHI_SAFE_MODE=true

# Redact PHI patterns in logs
REDACT_PHI_IN_LOGS=true

# PHI patterns to redact (regex)
PHI_PATTERNS=SSN:\\s*\\d{3}-\\d{2}-\\d{4},MRN:\\s*\\d+

# HIPAA audit logging
HIPAA_AUDIT_ENABLED=true

# Data retention (days)
MESSAGE_RETENTION_DAYS=365

# ------------------------------------------------------------
# ANALYTICS & METRICS
# ------------------------------------------------------------
# Enable message analytics
ENABLE_ANALYTICS=true

# Track metrics
TRACK_RESPONSE_TIME=true
TRACK_RESOLUTION_TIME=true
TRACK_CHANNEL_DISTRIBUTION=true
TRACK_INTENT_DISTRIBUTION=true

# Analytics export to Module 07
EXPORT_TO_ANALYTICS_MODULE=true

# ------------------------------------------------------------
# OUTBOUND CAMPAIGNS (OPTIONAL)
# ------------------------------------------------------------
# Enable outbound messaging
OUTBOUND_ENABLED=false

# Outbound rate limit (messages per minute)
OUTBOUND_RATE_LIMIT=10

# Opt-out keyword
OPTOUT_KEYWORD=STOP

# Opt-in confirmation
REQUIRE_OPTIN=true

# ------------------------------------------------------------
# ADVANCED FEATURES
# ------------------------------------------------------------
# Multi-language support
ENABLE_TRANSLATION=false
TRANSLATION_SERVICE=google
GOOGLE_TRANSLATE_API_KEY=your_api_key

# Rich media support (images, videos, buttons)
ENABLE_RICH_MEDIA=false

# Interactive messages (quick replies, buttons)
ENABLE_INTERACTIVE=false

# Voice message transcription
ENABLE_VOICE_TRANSCRIPTION=false
TRANSCRIPTION_SERVICE=assemblyai
ASSEMBLYAI_API_KEY=your_api_key

# ------------------------------------------------------------
# DEBUGGING & MONITORING
# ------------------------------------------------------------
# Debug mode
DEBUG_MODE=false

# Log all messages to console
LOG_ALL_MESSAGES=false

# Error workflow
ERROR_WORKFLOW_ID=

# Webhook retry configuration
WEBHOOK_RETRY_ENABLED=true
WEBHOOK_MAX_RETRIES=3
WEBHOOK_RETRY_DELAY_MS=1000

# ------------------------------------------------------------
# PERFORMANCE TUNING
# ------------------------------------------------------------
# API timeout (milliseconds)
API_TIMEOUT_MS=30000

# Concurrent message processing
MAX_CONCURRENT_MESSAGES=10

# Message queue enabled
ENABLE_MESSAGE_QUEUE=false

# Queue provider: redis, rabbitmq, sqs
QUEUE_PROVIDER=redis
REDIS_URL=redis://localhost:6379

# ------------------------------------------------------------
# WEBHOOKS & INTEGRATIONS
# ------------------------------------------------------------
# Forward messages to external systems
FORWARD_TO_EXTERNAL=false
EXTERNAL_WEBHOOK_URL=https://your-system.com/webhook

# Zapier integration
ZAPIER_WEBHOOK_URL=

# Make.com (Integromat) integration
MAKE_WEBHOOK_URL=

# ------------------------------------------------------------
# MODULE CHAINING
# ------------------------------------------------------------
# Accept messages from other modules
ACCEPT_FROM_MODULE_05=true

# Forward to other modules based on intent
FORWARD_BOOKING_TO_MODULE_02=true
FORWARD_BILLING_TO_MODULE_04=true

# Module webhook endpoints
MODULE_02_WEBHOOK=https://n8n.instance.com/webhook/aigent-booking
MODULE_04_WEBHOOK=https://n8n.instance.com/webhook/aigent-billing

# ------------------------------------------------------------
# NOTES
# ------------------------------------------------------------
# 1. All credentials should be stored in n8n's credential manager
#    Reference them using: {{$env.CREDENTIAL_ID}}
#
# 2. Webhook Configuration:
#    - Configure each messaging platform to POST to your n8n webhook
#    - Twilio SMS: https://your-n8n.com/webhook/aigent-message-hub
#    - Twilio WhatsApp: https://your-n8n.com/webhook/aigent-message-hub
#    - SendGrid Inbound: https://your-n8n.com/webhook/aigent-message-hub
#    - Telegram: Use Bot API setWebhook
#
# 3. Business Hours:
#    - Messages outside business hours trigger after-hours auto-response
#    - Urgent messages always notify staff regardless of hours
#
# 4. Intent Classification:
#    - booking: appointment-related queries
#    - billing: payment and invoice questions
#    - urgent: emergency situations
#    - support: general questions
#    - general: uncategorized messages
#
# 5. AIgent Bot:
#    - Requires separate AIgent bot instance
#    - Bot handles routine queries automatically
#    - Falls back to human staff if confidence < threshold
#
# 6. Message Routing Logic:
#    Priority 1: Urgent messages → Immediate staff alert
#    Priority 2: After-hours → Auto-response + queue for business hours
#    Priority 3: During hours + bot enabled → Bot response first
#    Priority 4: During hours + bot disabled → Staff notification
#    Priority 5: New contacts → Welcome message + staff notification
#
# 7. CRM Integration:
#    - Every message updates contact record with last_message metadata
#    - New contacts auto-created if not found
#    - Conversation history maintained in CRM notes
#
# 8. Logging:
#    - All messages logged to Google Sheets/Airtable/Database
#    - PHI redaction applied if PHI_SAFE_MODE=true
#    - Logs include: timestamp, channel, from, to, message, response
#
# 9. Staff Notifications:
#    - Slack: Real-time notifications with message preview
#    - Teams: Similar to Slack
#    - Email: Digest or immediate based on configuration
#
# 10. Test your workflow with test phone numbers before production
#
# ============================================================
