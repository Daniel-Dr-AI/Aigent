# ============================================================================
# Aigent Module 03 - Enhanced Telehealth Session (PHI-SENSITIVE)
# Environment Variables Template
# Version: 1.1.0-enhanced
# PHI Level: HIGH
# ============================================================================
#
# ⚠️ SECURITY WARNING: This module handles PHI (Protected Health Information)
# All configuration must comply with HIPAA Security Rule requirements
#
# INSTRUCTIONS:
# 1. Copy this file to your n8n environment configuration
# 2. Replace all placeholder values with your actual credentials/settings
# 3. NEVER commit the actual .env file to version control
# 4. Ensure BAA (Business Associate Agreement) with all service providers
# 5. Use encrypted storage for all credentials
# 6. Enable audit logging for all PHI access
#
# ============================================================================

# ----------------------------------------------------------------------------
# CORE WEBHOOK CONFIGURATION
# ----------------------------------------------------------------------------

# Webhook unique identifier
WEBHOOK_ID_MODULE_03=telehealth-session-v1

# CORS allowed origins (restrictive for PHI security)
# Production: MUST specify exact domains (never use *)
ALLOWED_ORIGINS=https://yourdomain.com,https://app.yourdomain.com

# ----------------------------------------------------------------------------
# TELEHEALTH VIDEO PLATFORM (Zoom / Doxy.me / Amwell)
# ----------------------------------------------------------------------------

# Platform provider name (for routing logic)
# Options: Zoom, Doxy.me, Amwell, Generic
TELEHEALTH_PROVIDER_NAME=Zoom

# API Base URL
# Zoom for Healthcare: https://api.zoom.us/v2
# Doxy.me: https://api.doxy.me/v1
# Amwell: https://api.amwell.com/v1
TELEHEALTH_API_BASE_URL=https://api.zoom.us/v2

# n8n Credential ID (from Credentials page)
TELEHEALTH_CREDENTIAL_ID=10

# n8n Credential Name (must match)
TELEHEALTH_CREDENTIAL_NAME=Zoom for Healthcare OAuth

# Meeting type (platform-specific)
# Zoom: 2 = scheduled meeting
# Doxy.me: standard
# Amwell: video_visit
TELEHEALTH_MEETING_TYPE=2

# ----------------------------------------------------------------------------
# ZOOM FOR HEALTHCARE SPECIFIC (If using Zoom)
# ----------------------------------------------------------------------------

# Zoom account type
# Options: basic, pro, business, healthcare
ZOOM_ACCOUNT_TYPE=healthcare

# Enable cloud recording (stored in Zoom)
# HIPAA: Requires BAA with Zoom
ENABLE_AUTO_RECORDING=true

# Recording retention days (Zoom cloud)
ZOOM_RECORDING_RETENTION_DAYS=365

# ----------------------------------------------------------------------------
# DOXY.ME SPECIFIC (If using Doxy.me)
# ----------------------------------------------------------------------------

# Doxy.me room prefix
DOXY_ROOM_PREFIX=clinic

# Doxy.me default PIN length
DOXY_PIN_LENGTH=6

# ----------------------------------------------------------------------------
# AMWELL SPECIFIC (If using Amwell)
# ----------------------------------------------------------------------------

# Amwell organization ID
AMWELL_ORG_ID=your-org-id

# Amwell service line ID
AMWELL_SERVICE_LINE_ID=telehealth

# ----------------------------------------------------------------------------
# SESSION SECURITY SETTINGS (HIPAA Critical)
# ----------------------------------------------------------------------------

# Enable waiting room (HIPAA best practice)
# Default: true (providers manually admit patients)
ENABLE_WAITING_ROOM=true

# Require session password
# Default: true (additional security layer)
REQUIRE_SESSION_PASSWORD=true

# Allow patients to join before provider
# Default: false (HIPAA best practice: provider controls session)
ALLOW_JOIN_BEFORE_HOST=false

# Session link expiration (days after appointment)
# Default: 1 (minimize window of potential unauthorized access)
SESSION_LINK_EXPIRY_DAYS=1

# Enable end-to-end encryption
# Default: true (HIPAA requirement for video sessions)
ENABLE_E2E_ENCRYPTION=true

# ----------------------------------------------------------------------------
# CLINIC CONFIGURATION
# ----------------------------------------------------------------------------

# Clinic unique identifier (for session ID generation)
CLINIC_ID=clinic001

# Clinic name
CLINIC_NAME=Your Clinic Name

# Clinic phone number
CLINIC_PHONE=+1-555-123-4567

# Clinic email
CLINIC_EMAIL=info@yourclinic.com

# Clinic timezone
CLINIC_TIMEZONE=America/New_York

# Default provider name (if not specified in booking)
DEFAULT_PROVIDER_NAME=Dr. Smith

# Provider email (for host link notifications)
PROVIDER_EMAIL=provider@yourclinic.com

# Default session duration (minutes)
DEFAULT_SESSION_DURATION=30

# ----------------------------------------------------------------------------
# CRM INTEGRATION (HubSpot Default)
# ----------------------------------------------------------------------------

# HubSpot Credential ID
HUBSPOT_CREDENTIAL_ID=1

# HubSpot Credential Name
HUBSPOT_CREDENTIAL_NAME=HubSpot Production Account

# CRM Retry Configuration
CRM_RETRY_COUNT=3
CRM_RETRY_DELAY_MS=1000

# ----------------------------------------------------------------------------
# SMS NOTIFICATIONS (Twilio)
# ----------------------------------------------------------------------------

# Twilio Credential ID
TWILIO_CREDENTIAL_ID=8

# Twilio Credential Name
TWILIO_CREDENTIAL_NAME=Twilio SMS Production

# Twilio phone number (clinic's SMS number)
TWILIO_FROM_NUMBER=+15551234567

# SMS Retry Configuration
SMS_RETRY_COUNT=2
SMS_RETRY_DELAY_MS=500

# ⚠️ HIPAA COMPLIANCE: Ensure Twilio account has BAA signed
# https://www.twilio.com/en-us/legal/tos

# ----------------------------------------------------------------------------
# EMAIL NOTIFICATIONS (SendGrid)
# ----------------------------------------------------------------------------

# SendGrid Credential ID
SENDGRID_CREDENTIAL_ID=11

# SendGrid Credential Name
SENDGRID_CREDENTIAL_NAME=SendGrid Production API

# SendGrid from email
SENDGRID_FROM_EMAIL=noreply@yourclinic.com

# SendGrid BCC email (for clinic copies)
SENDGRID_BCC_EMAIL=appointments@yourclinic.com

# Email Retry Configuration
EMAIL_RETRY_COUNT=2
EMAIL_RETRY_DELAY_MS=500

# ⚠️ HIPAA COMPLIANCE: Ensure SendGrid account has BAA signed
# https://sendgrid.com/resource/sendgrid-hipaa-compliance/

# ----------------------------------------------------------------------------
# BRANDING & CUSTOMIZATION
# ----------------------------------------------------------------------------

# Brand primary color (hex code)
BRAND_PRIMARY_COLOR=#4F46E5

# ----------------------------------------------------------------------------
# DATA STORAGE (Google Sheets / Airtable)
# ----------------------------------------------------------------------------

# Google Sheets Credential ID
GOOGLE_SHEETS_CREDENTIAL_ID=6

# Google Sheets Credential Name
GOOGLE_SHEETS_CREDENTIAL_NAME=Google Sheets OAuth

# Spreadsheet ID (from Google Sheets URL)
# https://docs.google.com/spreadsheets/d/{SPREADSHEET_ID}/edit
GOOGLE_SHEET_ID=your-spreadsheet-id-here

# Sheet tab name for telehealth logs
GOOGLE_SHEET_TAB_TELEHEALTH=Telehealth Sessions

# Data store retry configuration
DATASTORE_RETRY_COUNT=2
DATASTORE_RETRY_DELAY_MS=2000

# ⚠️ SECURITY: Ensure spreadsheet has restricted access (authorized staff only)
# Logged data includes masked PHI - still requires security controls

# ----------------------------------------------------------------------------
# ALTERNATE DATA STORAGE
# ----------------------------------------------------------------------------

# Airtable Configuration (Alternative to Google Sheets)
# AIRTABLE_CREDENTIAL_ID=7
# AIRTABLE_BASE_ID=your-base-id
# AIRTABLE_TABLE_NAME=Telehealth Sessions

# PostgreSQL Configuration (Alternative for high security)
# POSTGRES_CREDENTIAL_ID=8
# POSTGRES_DATABASE=clinic_db
# POSTGRES_TABLE=telehealth_sessions

# ----------------------------------------------------------------------------
# PHI MASKING & SECURITY (ENHANCED v1.1)
# ----------------------------------------------------------------------------

# Enable PHI masking in logs
# Default: true (HIPAA best practice - minimize PHI in logs)
ENABLE_PHI_MASKING=true

# PHI masking level (1-5)
# 1 = Minimal (last 4 digits of phone)
# 2 = Standard (email first/last char, phone last 4, name first char)
# 3 = Aggressive (all replaced with ***)
# Default: 2 (balance between security and usability)
PHI_MASKING_LEVEL=2

# Mask patient name in provider email subject
# Default: true (email previews visible in inbox)
MASK_PATIENT_NAME_IN_SUBJECT=true

# ----------------------------------------------------------------------------
# ENHANCED FEATURES (NEW in v1.1)
# ----------------------------------------------------------------------------

# Enable execution time tracking
ENABLE_PERFORMANCE_TRACKING=true

# Enable session expiration tracking
# Automatically tracks when session links expire
ENABLE_EXPIRATION_TRACKING=true

# Enable recording URL capture
# Captures cloud recording URL for post-session storage
ENABLE_RECORDING_URL_CAPTURE=true

# Pre-session reminder (hours before appointment)
# Send reminder with tech check instructions
PRE_SESSION_REMINDER_HOURS=24,2

# Enable emergency keyword detection (future enhancement)
# Monitors session chat for emergency keywords
ENABLE_EMERGENCY_DETECTION=false

# ----------------------------------------------------------------------------
# OBSERVABILITY & MONITORING
# ----------------------------------------------------------------------------

# Enable debug mode
DEBUG_MODE=false

# Save execution data
SAVE_EXECUTION_DATA=all

# Support email
SUPPORT_EMAIL=support@yourclinic.com

# ----------------------------------------------------------------------------
# GLOBAL ERROR HANDLING
# ----------------------------------------------------------------------------

# Error workflow ID (centralized error handling)
ERROR_WORKFLOW_ID=

# Alert on critical failures (session creation failures)
ALERT_ON_CRITICAL_FAILURES=true

# Critical failure webhook (Slack, PagerDuty, etc.)
CRITICAL_FAILURE_WEBHOOK_URL=

# ----------------------------------------------------------------------------
# N8N INSTANCE CONFIGURATION
# ----------------------------------------------------------------------------

# n8n instance identifier
N8N_INSTANCE_ID=production-001

# Workflow version
WORKFLOW_VERSION=1.1.0-enhanced

# Timezone for timestamps
TZ=America/New_York

# Environment
NODE_ENV=production

# ----------------------------------------------------------------------------
# SECURITY & COMPLIANCE (HIPAA CRITICAL)
# ----------------------------------------------------------------------------

# HIPAA mode (enables strict security checks)
HIPAA_MODE=true

# Data retention period (days)
# HIPAA: 6 years minimum (2190 days)
DATA_RETENTION_DAYS=2555

# Enable audit logging
# REQUIRED for HIPAA compliance
AUDIT_LOG_ENABLED=true

# Encryption at rest
# All stored PHI must be encrypted
ENABLE_ENCRYPTION_AT_REST=true

# Encryption key rotation (days)
# Recommended: 90 days
ENCRYPTION_KEY_ROTATION_DAYS=90

# ----------------------------------------------------------------------------
# PERFORMANCE TUNING
# ----------------------------------------------------------------------------

# Workflow execution timeout (milliseconds)
# Telehealth session creation can take longer than booking
WORKFLOW_TIMEOUT_MS=180000

# Maximum parallel executions
MAX_PARALLEL_EXECUTIONS=5

# API timeout configurations (milliseconds)
TELEHEALTH_API_TIMEOUT_MS=15000
CRM_API_TIMEOUT_MS=10000
SMS_API_TIMEOUT_MS=5000
EMAIL_API_TIMEOUT_MS=5000
DATASTORE_API_TIMEOUT_MS=10000

# ----------------------------------------------------------------------------
# INTEGRATION WITH OTHER MODULES
# ----------------------------------------------------------------------------

# Module 02 (Booking) webhook URL
MODULE_02_WEBHOOK_URL=https://n8n.yourclinic.com/webhook/consult-booking

# Module 04 (Billing) webhook URL
MODULE_04_WEBHOOK_URL=https://n8n.yourclinic.com/webhook/billing-payment

# Module 07 (Analytics) ingestion endpoint
MODULE_07_ANALYTICS_API=https://n8n.yourclinic.com/webhook/07-analytics-ingest

# Module 09 (Audit) webhook URL
MODULE_09_AUDIT_WEBHOOK_URL=https://n8n.yourclinic.com/webhook/09-compliance-audit

# ----------------------------------------------------------------------------
# FUTURE ENHANCEMENTS (Placeholders)
# ----------------------------------------------------------------------------

# Pre-session tech check URL
# PRE_SESSION_TECH_CHECK_URL=https://techcheck.yourclinic.com

# Recording storage service
# RECORDING_STORAGE_SERVICE=S3
# RECORDING_S3_BUCKET=clinic-telehealth-recordings

# Session transcript service (for AI analysis)
# ENABLE_TRANSCRIPT_GENERATION=false
# TRANSCRIPT_SERVICE_API=

# EHR integration
# EHR_API_BASE_URL=
# EHR_CREDENTIAL_ID=

# ============================================================================
# END OF CONFIGURATION
# ============================================================================
#
# SECURITY CHECKLIST:
# [ ] All service providers have signed BAAs
# [ ] Twilio account is HIPAA-compliant
# [ ] SendGrid account is HIPAA-compliant
# [ ] Video platform is HIPAA-compliant (Zoom Healthcare, not Zoom Basic)
# [ ] Google Sheets has restricted access permissions
# [ ] CORS origins are restrictive (no wildcard *)
# [ ] Waiting room is enabled (ENABLE_WAITING_ROOM=true)
# [ ] Session password is required (REQUIRE_SESSION_PASSWORD=true)
# [ ] PHI masking is enabled (ENABLE_PHI_MASKING=true)
# [ ] Audit logging is enabled (AUDIT_LOG_ENABLED=true)
# [ ] Encryption at rest is enabled
# [ ] Session links expire within 24 hours
# [ ] No PHI in error logs or staff notifications
#
# HIPAA COMPLIANCE CHECKLIST:
# [ ] BAA agreements in place with:
#     - Video platform (Zoom/Doxy.me/Amwell)
#     - SMS provider (Twilio)
#     - Email provider (SendGrid)
#     - Data storage (Google Workspace / Airtable / Database host)
#     - n8n hosting provider (if cloud-hosted)
# [ ] Access controls configured:
#     - n8n user roles restricted
#     - Workflow execution permissions set
#     - Credential access limited to authorized users
# [ ] Audit trail enabled:
#     - All PHI access logged
#     - Logs include user, timestamp, action
#     - Logs retained for required period
# [ ] Encryption configured:
#     - TLS 1.2+ for all API calls
#     - Enhanced encryption for video sessions
#     - Encrypted database storage
# [ ] Breach notification plan documented
# [ ] Security incident response plan in place
# [ ] Regular security risk assessments scheduled
#
# TESTING CHECKLIST:
# [ ] Test session creation with valid appointment data
# [ ] Test validation errors (missing fields, invalid formats)
# [ ] Test video platform integration (Zoom/Doxy/Amwell)
# [ ] Test PHI masking (check logs for masked data)
# [ ] Test SMS delivery (patient receives link)
# [ ] Test email delivery (patient and provider receive emails)
# [ ] Test CRM update (session details saved)
# [ ] Test session expiration tracking
# [ ] Test retry logic (simulate API failures)
# [ ] Test graceful degradation (CRM fails, session still succeeds)
# [ ] Test execution time tracking
# [ ] Test with different timezones
# [ ] Test session password protection
# [ ] Test waiting room functionality
# [ ] Verify no PHI in error messages
# [ ] Verify masked PHI in provider email subject
#
# MONITORING CHECKLIST:
# [ ] Set up alerts for session creation failures
# [ ] Monitor avg execution time (<2200ms)
# [ ] Monitor success rate (>95%)
# [ ] Monitor video platform API status
# [ ] Monitor CRM/SMS/email delivery rates
# [ ] Track PHI access in audit logs
# [ ] Review execution logs for unmasked PHI
# [ ] Monitor session expiration cleanup
#
# For support: support@aigent.company
# Documentation: https://docs.aigent.company/templates/module-03-enhanced
# HIPAA Guidance: https://www.hhs.gov/hipaa/for-professionals/security/index.html
# ============================================================================
