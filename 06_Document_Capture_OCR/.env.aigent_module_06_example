# ============================================================
# AIGENT MODULE 06 - DOCUMENT CAPTURE & OCR
# Environment Configuration Template
# ============================================================
# Version: 1.0.0
# Last Updated: 2025-01-15
# Purpose: Document ingestion, OCR processing, structured extraction, secure storage, and EHR/CRM sync
# ============================================================

# ------------------------------------------------------------
# WEBHOOK CONFIGURATION
# ------------------------------------------------------------
WEBHOOK_ID_MODULE_06=your_webhook_id_here
ALLOWED_ORIGINS=*

# ------------------------------------------------------------
# GENERAL SECURITY & COMPLIANCE
# ------------------------------------------------------------
# HIPAA Mode: enforces BAA-compliant vendors, signed URLs, encryption
HIPAA_MODE=true

# Approved sources: webhook, s3, gdrive, email
APPROVED_SOURCE_LIST=webhook,s3,gdrive,email

# File validation
MAX_FILE_MB=15
ALLOWED_MIME=application/pdf,image/jpeg,image/png,image/tiff

# Document type fallback if not specified
DOC_TYPE_FALLBACK=other

# Redaction: mask SSN, MRN, credit cards, emails
REDACTION_ENABLED=true

# ------------------------------------------------------------
# OCR ENGINE CONFIGURATION
# ------------------------------------------------------------
# Options: mistral, gemini, abbyy, tesseract
OCR_ENGINE=mistral

# OCR Language (ISO 639-2 for Tesseract/ABBYY, or 'eng' for Mistral/Gemini)
OCR_LANGUAGE=eng

# Mistral OCR API
MISTRAL_OCR_API_KEY=your_mistral_api_key_here
MISTRAL_OCR_ENDPOINT=https://api.mistral.ai/v1/ocr

# Google Gemini Vision API
GEMINI_API_KEY=your_gemini_api_key_here
GEMINI_MODEL=gemini-pro-vision
GEMINI_ENDPOINT=https://generativelanguage.googleapis.com/v1beta/models/gemini-pro-vision:generateContent

# ABBYY Cloud OCR
ABBYY_APP_ID=your_abbyy_app_id
ABBYY_APP_PASSWORD=your_abbyy_password
ABBYY_ENDPOINT=https://cloud-eu.abbyy.com/v2/processImage
ABBYY_CREDENTIAL_ID=your_n8n_abbyy_credential_id

# Tesseract (Self-Hosted)
TESSERACT_CMD=/usr/bin/tesseract
TESSERACT_DATA_PATH=/usr/share/tesseract-ocr/4.00/tessdata

# ------------------------------------------------------------
# STORAGE CONFIGURATION
# ------------------------------------------------------------
# Provider: s3 or gdrive
STORAGE_PROVIDER=s3

# AWS S3 Configuration
S3_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
S3_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
S3_REGION=us-east-1
S3_BUCKET=aigent-clinic-documents
S3_PREFIX=clinic-docs/

# S3 Storage Class (STANDARD, INTELLIGENT_TIERING, GLACIER)
S3_STORAGE_CLASS=STANDARD

# AWS Credential ID (n8n credential manager)
AWS_CREDENTIAL_ID=your_aws_credential_id
AWS_CREDENTIAL_NAME=AWS Credentials

# Signed URL TTL (seconds) - use short TTL for HIPAA compliance
SIGNED_URL_TTL_SECONDS=600

# Google Drive Configuration (alternative)
GDRIVE_CREDENTIAL_ID=your_gdrive_credential_id
GDRIVE_FOLDER_ID=1aBcDeFgHiJkLmNoPqRsTuVwXyZ
GDRIVE_FOLDER_NAME=Clinic Documents

# ------------------------------------------------------------
# EHR / INTEROPERABILITY CONFIGURATION
# ------------------------------------------------------------
# Enable EHR sync
EHR_SYNC_ENABLED=false

# EHR Target: redox, drchrono, nextgen
EHR_TARGET=drchrono

# Redox Configuration
REDOX_API_KEY=your_redox_api_key
REDOX_SECRET=your_redox_secret
REDOX_SOURCE_ID=your_source_id
REDOX_DESTINATION_ID=your_destination_id
REDOX_ENDPOINT=https://api.redoxengine.com/endpoint

# DrChrono Configuration
DRCHRONO_TOKEN=your_drchrono_oauth_token
DRCHRONO_CLIENT_ID=your_client_id
DRCHRONO_CLIENT_SECRET=your_client_secret
DRCHRONO_API_BASE=https://app.drchrono.com/api
DRCHRONO_CREDENTIAL_ID=your_drchrono_credential_id

# NextGen Configuration
NEXTGEN_CLIENT_ID=your_nextgen_client_id
NEXTGEN_CLIENT_SECRET=your_nextgen_client_secret
NEXTGEN_BASE_URL=https://api.nextgen.com
NEXTGEN_PRACTICE_ID=your_practice_id
NEXTGEN_CREDENTIAL_ID=your_nextgen_credential_id

# ------------------------------------------------------------
# CRM CONFIGURATION
# ------------------------------------------------------------
# Enable CRM sync
CRM_SYNC_ENABLED=true

# CRM Target: hubspot, salesforce, zoho
CRM_TARGET=hubspot

# HubSpot Configuration
HUBSPOT_API_KEY=pat-na1-your-private-app-token
HUBSPOT_CREDENTIAL_ID=your_hubspot_credential_id
HUBSPOT_CREDENTIAL_NAME=HubSpot OAuth2 API

# Salesforce Configuration
SALESFORCE_CREDENTIAL_ID=your_salesforce_credential_id
SALESFORCE_INSTANCE_URL=https://yourinstance.salesforce.com
SALESFORCE_API_VERSION=v57.0

# Zoho CRM Configuration
ZOHO_CREDENTIAL_ID=your_zoho_credential_id
ZOHO_API_DOMAIN=https://www.zohoapis.com
ZOHO_ORGANIZATION_ID=your_org_id

# ------------------------------------------------------------
# CRM FIELD MAPPING
# ------------------------------------------------------------
CRM_FIELD_LAST_DOCUMENT_UPLOAD=last_document_upload
CRM_FIELD_LAST_DOCUMENT_TYPE=last_document_type
CRM_FIELD_DOCUMENT_URL=document_url
CRM_FIELD_DOCUMENT_COUNT=document_count

# ------------------------------------------------------------
# COMPLIANCE LOGGING
# ------------------------------------------------------------
# Log target: sheets or airtable
LOG_TARGET=sheets

# Google Sheets Configuration
GOOGLE_SHEETS_CREDENTIAL_ID=your_gsheet_credential_id
GOOGLE_SHEET_ID=1aBcDeFgHiJkLmNoPqRsTuVwXyZ123456789
GOOGLE_SHEET_TAB=OCR_Log

# Google Sheets column mapping
GSHEET_COLUMNS=Timestamp,Document ID,Doc Type,Patient ID,Patient Name,Source,File Size (MB),OCR Engine,Confidence,Redacted,Storage URL,EHR Synced,CRM Synced,Trace ID

# Airtable Configuration (alternative)
AIRTABLE_CREDENTIAL_ID=your_airtable_credential_id
AIRTABLE_API_KEY=keyXXXXXXXXXXXXXX
AIRTABLE_BASE_ID=appXXXXXXXXXXXXXX
AIRTABLE_TABLE=OCR_Log

# ------------------------------------------------------------
# DOCUMENT TYPE MAPPING
# ------------------------------------------------------------
# Recognized document types (auto-inferred from filename if not specified)
DOC_TYPES=intake_form,id_card,insurance_card,lab_result,invoice,consent_form,prescription,referral,other

# Filename patterns for auto-detection (regex-compatible)
PATTERN_LAB_RESULT=lab|result|test
PATTERN_INTAKE_FORM=intake|form|registration
PATTERN_ID_CARD=id|card|license|passport
PATTERN_INSURANCE=insurance|coverage|policy
PATTERN_INVOICE=invoice|bill|statement
PATTERN_CONSENT=consent|authorization|waiver

# ------------------------------------------------------------
# EXTRACTION TEMPLATES (Doc-Type Specific)
# ------------------------------------------------------------
# Lab Result Fields
LAB_EXTRACT_FIELDS=hdl,ldl,glucose,a1c,cholesterol,triglycerides

# Intake Form Fields
INTAKE_EXTRACT_FIELDS=dob,phone,address,emergency_contact

# Insurance Card Fields
INSURANCE_EXTRACT_FIELDS=member_id,group_number,plan_name,effective_date

# ------------------------------------------------------------
# REDACTION CONFIGURATION
# ------------------------------------------------------------
# Patterns to redact (regex)
REDACT_SSN=true
REDACT_CREDIT_CARD=true
REDACT_MRN=true
REDACT_EMAIL=true
REDACT_PHONE=false

# Redaction character
REDACTION_CHAR=*

# Preserve last N digits (for identification)
REDACT_PRESERVE_LAST_DIGITS=4

# ------------------------------------------------------------
# EMAIL INGESTION (IMAP WATCHER - OPTIONAL)
# ------------------------------------------------------------
# Enable email attachment ingestion
EMAIL_INGESTION_ENABLED=false

# IMAP Configuration
IMAP_HOST=imap.gmail.com
IMAP_PORT=993
IMAP_USER=documents@yourclinic.com
IMAP_PASSWORD=your_app_password
IMAP_TLS=true
IMAP_FOLDER=INBOX
IMAP_CREDENTIAL_ID=your_imap_credential_id

# Email parsing
EMAIL_SUBJECT_PATTERN=Document Upload
EMAIL_ATTACHMENT_MAX_MB=15

# ------------------------------------------------------------
# S3 WATCHER (OPTIONAL)
# ------------------------------------------------------------
# Enable S3 bucket watching for new uploads
S3_WATCH_ENABLED=false
S3_WATCH_BUCKET=aigent-uploads
S3_WATCH_PREFIX=incoming/
S3_WATCH_POLL_INTERVAL_SECONDS=60

# ------------------------------------------------------------
# GOOGLE DRIVE WATCHER (OPTIONAL)
# ------------------------------------------------------------
# Enable Google Drive folder watching
GDRIVE_WATCH_ENABLED=false
GDRIVE_WATCH_FOLDER_ID=1aBcDeFgHiJkLmNoPqRsTuVwXyZ
GDRIVE_WATCH_POLL_INTERVAL_SECONDS=60

# ------------------------------------------------------------
# ERROR HANDLING
# ------------------------------------------------------------
# Error workflow ID (n8n workflow to handle failures)
ERROR_WORKFLOW_ID=

# Continue on OCR failure (return partial results)
CONTINUE_ON_OCR_FAILURE=false

# Continue on storage failure
CONTINUE_ON_STORAGE_FAILURE=false

# Continue on EHR sync failure
CONTINUE_ON_EHR_FAILURE=true

# Continue on CRM sync failure
CONTINUE_ON_CRM_FAILURE=true

# Retry configuration
MAX_RETRIES=3
RETRY_DELAY_MS=1000

# ------------------------------------------------------------
# DEBUG & TESTING
# ------------------------------------------------------------
DEBUG_MODE=false
LOG_ALL_REQUESTS=false

# Test mode: skip actual uploads and API calls
TEST_MODE=false
TEST_MOCK_OCR_RESPONSE=true

# Sample test input
TEST_PATIENT_ID=test_patient_123
TEST_PATIENT_EMAIL=test@example.com
TEST_DOCUMENT_TYPE=lab_result

# ------------------------------------------------------------
# PERFORMANCE TUNING
# ------------------------------------------------------------
# OCR timeout (milliseconds)
OCR_TIMEOUT_MS=30000

# Storage upload timeout (milliseconds)
STORAGE_TIMEOUT_MS=60000

# API request timeout (milliseconds)
API_TIMEOUT_MS=10000

# Enable parallel processing for storage/sync
ENABLE_PARALLEL_SYNC=true

# ------------------------------------------------------------
# ADVANCED SECURITY
# ------------------------------------------------------------
# File hash algorithm (for integrity verification)
HASH_ALGORITHM=sha256

# Encrypt files at rest (S3 server-side encryption)
S3_SERVER_SIDE_ENCRYPTION=AES256

# KMS Key ID (if using KMS encryption)
S3_KMS_KEY_ID=

# Enable versioning for S3 objects
S3_VERSIONING_ENABLED=true

# Object lock (WORM - Write Once Read Many)
S3_OBJECT_LOCK_ENABLED=false

# ------------------------------------------------------------
# AUDIT & COMPLIANCE
# ------------------------------------------------------------
# Log retention period (days)
LOG_RETENTION_DAYS=2555

# Enable detailed audit trail
AUDIT_TRAIL_ENABLED=true

# Compliance standards
COMPLIANCE_STANDARDS=HIPAA,SOC2

# BAA-approved vendors only
REQUIRE_BAA_VENDORS=true

# BAA-approved vendor list
BAA_APPROVED_VENDORS=mistral,gemini,abbyy,aws,hubspot,drchrono,redox

# ------------------------------------------------------------
# NOTIFICATIONS (OPTIONAL)
# ------------------------------------------------------------
# Send notifications on successful processing
NOTIFY_ON_SUCCESS=false

# Send notifications on failure
NOTIFY_ON_FAILURE=true

# Notification channel: slack, email, webhook
NOTIFICATION_CHANNEL=slack

# Slack webhook for notifications
SLACK_NOTIFICATION_WEBHOOK=https://hooks.slack.com/services/YOUR/WEBHOOK/URL
SLACK_NOTIFICATION_CHANNEL=#document-processing

# Email notification
NOTIFICATION_EMAIL=admin@yourclinic.com

# ------------------------------------------------------------
# MODULE CHAINING
# ------------------------------------------------------------
# Accept input from upstream modules (01-05)
ACCEPTS_UPSTREAM_INPUT=true

# Pass output to downstream modules (if any)
OUTPUT_FOR_DOWNSTREAM=true

# Output schema version
OUTPUT_SCHEMA_VERSION=1.0.0

# Trace ID prefix
TRACE_ID_PREFIX=DOC

# ------------------------------------------------------------
# CLINIC INFORMATION
# ------------------------------------------------------------
CLINIC_NAME=Your Clinic Name
CLINIC_ID=clinic_12345
CLINIC_TIMEZONE=America/New_York

# ------------------------------------------------------------
# NOTES
# ------------------------------------------------------------
# 1. All credentials should be stored in n8n's credential manager
#    Reference them using: {{$env.CREDENTIAL_ID}}
#
# 2. HIPAA Mode enforces:
#    - BAA-compliant vendors only
#    - Time-limited signed URLs
#    - Server-side encryption
#    - Audit logging
#
# 3. OCR Engines:
#    - Mistral: Fast, high accuracy, commercial API
#    - Gemini: Google's vision model, structured extraction
#    - ABBYY: Premium OCR, best for complex documents
#    - Tesseract: Open-source, self-hosted, lower accuracy
#
# 4. Document Types:
#    - intake_form: Patient registration forms
#    - id_card: Driver's license, passport
#    - insurance_card: Insurance cards (front/back)
#    - lab_result: Lab test results
#    - invoice: Billing statements
#    - consent_form: Signed consent forms
#    - other: Uncategorized documents
#
# 5. Redaction:
#    - Masks SSN (XXX-XX-1234 → XXX-XX-****)
#    - Masks credit cards (**** **** **** 1234)
#    - Masks MRN (MRN: 123456789 → MRN: ****6789)
#    - Masks email (user@example.com → u***@example.com)
#
# 6. Storage:
#    - S3: Recommended for HIPAA compliance (encryption, versioning)
#    - Google Drive: Alternative, ensure BAA with Google Workspace
#
# 7. EHR Integration:
#    - Redox: Universal interoperability platform
#    - DrChrono: Direct API integration
#    - NextGen: Practice management system
#
# 8. Test your workflow with TEST_MODE=true before production
#
# 9. File size limit (MAX_FILE_MB) should account for:
#    - Upload time
#    - OCR processing time
#    - Storage costs
#
# 10. Signed URL TTL (SIGNED_URL_TTL_SECONDS):
#     - HIPAA Mode: Use short TTL (600s = 10 minutes)
#     - Non-HIPAA: Can extend to 3600s (1 hour)
#
# ============================================================
