# ============================================================
# AIGENT MODULE 05 - FOLLOW-UP & RETENTION
# Environment Configuration Template
# ============================================================
# Version: 1.0.0
# Last Updated: 2025-01-15
# Purpose: Multi-touch post-visit follow-up sequence with surveys and rebooking
# ============================================================

# ------------------------------------------------------------
# WEBHOOK CONFIGURATION
# ------------------------------------------------------------
WEBHOOK_ID_MODULE_05=your_webhook_id_here
WEBHOOK_ID_SURVEY=your_survey_webhook_id_here

# Wait node webhook IDs (required for n8n execution resumption)
WAIT_WEBHOOK_DAY3=your_day3_wait_webhook_id
WAIT_WEBHOOK_DAY7=your_day7_wait_webhook_id
WAIT_WEBHOOK_DAY14=your_day14_wait_webhook_id

# ------------------------------------------------------------
# CLINIC BRANDING
# ------------------------------------------------------------
CLINIC_NAME=Your Clinic Name
CLINIC_SUPPORT_EMAIL=support@yourclinic.com
CLINIC_SUPPORT_PHONE=+1-555-123-4567

# ------------------------------------------------------------
# FOLLOW-UP SEQUENCE TIMING
# ------------------------------------------------------------
# Day-0: Immediate (sent right after visit completion)
# Day-3: Check-in after 72 hours
FOLLOWUP_DAY3_DELAY_HOURS=72

# Day-7: Survey after 96 additional hours (7 days total from visit)
FOLLOWUP_DAY7_DELAY_HOURS=96

# Day-14: Rebooking offer after 168 additional hours (14 days total from visit)
FOLLOWUP_DAY14_DELAY_HOURS=168

# ------------------------------------------------------------
# EMAIL CONFIGURATION
# ------------------------------------------------------------
# Provider: sendgrid, mailgun, aws_ses, postmark, resend
EMAIL_PROVIDER=sendgrid

# SendGrid Configuration
EMAIL_API_ENDPOINT=https://api.sendgrid.com/v3/mail
EMAIL_API_KEY=SG.your_sendgrid_api_key_here
EMAIL_FROM_ADDRESS=noreply@yourclinic.com
EMAIL_FROM_NAME=Your Clinic Team
EMAIL_REPLY_TO=support@yourclinic.com

# Mailgun Configuration (alternative)
# EMAIL_API_ENDPOINT=https://api.mailgun.net/v3/yourdomain.com/messages
# EMAIL_API_KEY=your_mailgun_api_key

# AWS SES Configuration (alternative)
# EMAIL_API_ENDPOINT=https://email.us-east-1.amazonaws.com
# EMAIL_API_KEY=your_aws_access_key_id
# EMAIL_SECRET=your_aws_secret_access_key

# ------------------------------------------------------------
# SMS CONFIGURATION
# ------------------------------------------------------------
# Provider: twilio, vonage, telnyx, bandwidth
SMS_PROVIDER=twilio

# Twilio Configuration
SMS_API_ENDPOINT=https://api.twilio.com/2010-04-01/Accounts/YOUR_ACCOUNT_SID/Messages.json
SMS_API_KEY=Basic YOUR_BASE64_ENCODED_CREDENTIALS
SMS_FROM_NUMBER=+15551234567
SMS_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
SMS_AUTH_TOKEN=your_auth_token_here

# Vonage Configuration (alternative)
# SMS_API_ENDPOINT=https://rest.nexmo.com/sms/json
# SMS_API_KEY=your_vonage_api_key
# SMS_API_SECRET=your_vonage_api_secret
# SMS_FROM_NUMBER=YourClinic

# ------------------------------------------------------------
# SURVEY CONFIGURATION
# ------------------------------------------------------------
# Provider: typeform, google_forms, surveymonkey, jotform
SURVEY_PROVIDER=typeform

# Survey Base URL (with hidden fields for tracking)
SURVEY_BASE_URL=https://form.typeform.com/to/YOUR_FORM_ID

# Typeform Configuration
TYPEFORM_FORM_ID=YOUR_FORM_ID
TYPEFORM_API_KEY=tfp_your_typeform_api_key_here

# Google Forms Configuration (alternative)
# SURVEY_BASE_URL=https://docs.google.com/forms/d/e/YOUR_FORM_ID/viewform
# GFORMS_PREFILL_PARAMS=?entry.123456789={email}&entry.987654321={patient_id}

# ------------------------------------------------------------
# NPS (NET PROMOTER SCORE) CONFIGURATION
# ------------------------------------------------------------
# NPS scale: 0-10
# Promoter: 9-10
# Passive: 7-8
# Detractor: 0-6
NPS_LOW_THRESHOLD=7
NPS_ALERT_ENABLED=true

# ------------------------------------------------------------
# STAFF ALERT CONFIGURATION (Low NPS)
# ------------------------------------------------------------
# Provider: slack, microsoft_teams, email, webhook
ALERT_PROVIDER=slack

# Slack Configuration
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL
SLACK_ALERT_CHANNEL=#patient-feedback
SLACK_BOT_NAME=Aigent Feedback Bot

# Microsoft Teams Configuration (alternative)
# TEAMS_WEBHOOK_URL=https://outlook.office.com/webhook/YOUR_WEBHOOK_URL

# Email Alert Configuration (alternative)
# ALERT_EMAIL_TO=staff@yourclinic.com,manager@yourclinic.com

# ------------------------------------------------------------
# REBOOKING CONFIGURATION
# ------------------------------------------------------------
# Rebooking link source (from Module 02 booking system)
REBOOKING_LINK=https://booking.yourclinic.com/schedule

# UTM parameters for tracking conversion
REBOOKING_UTM_SOURCE=followup
REBOOKING_UTM_MEDIUM=email
REBOOKING_UTM_CAMPAIGN=day14_rebook

# ------------------------------------------------------------
# CRM CONFIGURATION
# ------------------------------------------------------------
# Provider: hubspot, salesforce, zoho_crm, pipedrive
CRM_PROVIDER=hubspot

# HubSpot Configuration
CRM_CREDENTIAL_ID=your_n8n_credential_id
CRM_CREDENTIAL_NAME=HubSpot OAuth2 API
HUBSPOT_API_KEY=pat-na1-your-private-app-token

# Salesforce Configuration (alternative)
# CRM_PROVIDER=salesforce
# CRM_CREDENTIAL_ID=your_salesforce_credential_id
# SALESFORCE_INSTANCE_URL=https://yourinstance.salesforce.com
# SALESFORCE_API_VERSION=v57.0

# Zoho CRM Configuration (alternative)
# CRM_PROVIDER=zoho_crm
# CRM_CREDENTIAL_ID=your_zoho_credential_id
# ZOHO_API_DOMAIN=https://www.zohoapis.com

# ------------------------------------------------------------
# CRM FIELD MAPPING
# ------------------------------------------------------------
# Map n8n fields to your CRM custom properties
CRM_FIELD_NPS_SCORE=nps_score
CRM_FIELD_NPS_CATEGORY=nps_category
CRM_FIELD_LAST_SURVEY_DATE=last_survey_date
CRM_FIELD_FOLLOWUP_STATUS=followup_sequence_status
CRM_FIELD_LAST_TOUCH_DATE=last_followup_touch

# ------------------------------------------------------------
# DATA LOGGING CONFIGURATION
# ------------------------------------------------------------
# Provider: google_sheets, airtable, postgres, mysql
LOG_PROVIDER=google_sheets

# Google Sheets Configuration
GSHEET_CREDENTIAL_ID=your_gsheet_credential_id
GSHEET_CREDENTIAL_NAME=Google Sheets Service Account
GSHEET_SURVEY_LOG_ID=your_google_sheet_id_here
GSHEET_SURVEY_SHEET_NAME=Survey_Responses

# Google Sheets column mapping (ensure your sheet has these headers)
GSHEET_COLUMNS=Timestamp,Patient ID,Email,NPS Score,NPS Category,Feedback,Trace ID,Survey Provider

# Airtable Configuration (alternative)
# AIRTABLE_API_KEY=keyXXXXXXXXXXXXXX
# AIRTABLE_BASE_ID=appXXXXXXXXXXXXXX
# AIRTABLE_TABLE_NAME=Survey_Responses

# ------------------------------------------------------------
# WHATSAPP CONFIGURATION (OPTIONAL)
# ------------------------------------------------------------
# Enable WhatsApp messaging (requires Twilio Business Account or WhatsApp Business API)
WHATSAPP_ENABLED=false
WHATSAPP_PROVIDER=twilio
WHATSAPP_FROM_NUMBER=whatsapp:+15551234567
WHATSAPP_API_ENDPOINT=https://api.twilio.com/2010-04-01/Accounts/YOUR_ACCOUNT_SID/Messages.json

# ------------------------------------------------------------
# TEMPLATE CUSTOMIZATION
# ------------------------------------------------------------
# Message tone: professional, friendly, casual
MESSAGE_TONE=friendly

# Include provider name in messages
INCLUDE_PROVIDER_NAME=true

# Include clinic branding in footers
INCLUDE_CLINIC_BRANDING=true

# ------------------------------------------------------------
# SECURITY & COMPLIANCE
# ------------------------------------------------------------
# PHI-safe mode (excludes diagnosis codes, clinical notes)
PHI_SAFE_MODE=true

# Opt-out link for follow-up messages
OPTOUT_LINK_ENABLED=true
OPTOUT_LINK_URL=https://yourclinic.com/unsubscribe

# Data retention period (days)
SURVEY_DATA_RETENTION_DAYS=365

# ------------------------------------------------------------
# ERROR HANDLING
# ------------------------------------------------------------
# Continue workflow on email/SMS failures
CONTINUE_ON_SEND_FAILURE=true

# Retry failed sends
RETRY_FAILED_SENDS=true
MAX_SEND_RETRIES=3

# ------------------------------------------------------------
# TESTING & DEBUG
# ------------------------------------------------------------
# Test mode (sends all communications to test addresses)
TEST_MODE=false
TEST_EMAIL_OVERRIDE=test@yourclinic.com
TEST_PHONE_OVERRIDE=+15559999999

# Debug logging
DEBUG_MODE=false
LOG_ALL_REQUESTS=false

# ------------------------------------------------------------
# MODULE CHAINING
# ------------------------------------------------------------
# Accept input from Module 04 (Billing & Payments)
ACCEPTS_MODULE_04_OUTPUT=true

# Input schema validation
VALIDATE_INPUT_SCHEMA=true
REQUIRE_PATIENT_ID=true
REQUIRE_PATIENT_EMAIL=true
REQUIRE_VISIT_TYPE=true

# Output schema for downstream modules (if any)
OUTPUT_SCHEMA_VERSION=1.0.0

# ------------------------------------------------------------
# NOTES
# ------------------------------------------------------------
# 1. All credentials should be stored in n8n's credential manager
#    Reference them using: {{$env.CREDENTIAL_NAME}}
#
# 2. Wait nodes require webhook IDs for execution resumption
#    Generate unique IDs for each wait node
#
# 3. Survey webhook should be configured in your survey provider
#    (Typeform/Google Forms) to POST responses to n8n
#
# 4. NPS scoring:
#    - Promoters (9-10): Happy customers likely to refer
#    - Passives (7-8): Satisfied but not enthusiastic
#    - Detractors (0-6): Unhappy customers - need attention
#
# 5. Timing recommendations:
#    - Day-0: Immediate thank you (builds rapport)
#    - Day-3: Check-in (shows you care)
#    - Day-7: Survey (enough time for reflection)
#    - Day-14: Rebooking (top-of-mind for next visit)
#
# 6. Test your workflow with TEST_MODE=true before production
#
# 7. Ensure your survey includes:
#    - NPS question (0-10 scale)
#    - Open-ended feedback field
#    - Hidden fields: email, patient_id, trace_id
#
# ============================================================
