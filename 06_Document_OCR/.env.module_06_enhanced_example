# ============================================================================
# Aigent Module 06 - Enhanced Document Capture & OCR (PHI-SENSITIVE)
# Environment Variables Template
# Version: 1.1.0-enhanced
# PHI Level: VERY HIGH
# ============================================================================
#
# ⚠️ SECURITY WARNING: This module handles medical documents with full PHI
# All configuration must comply with HIPAA Security Rule requirements
#
# INSTRUCTIONS:
# 1. Copy this file to your n8n environment configuration
# 2. Replace all placeholder values with your actual credentials/settings
# 3. NEVER commit the actual .env file to version control
# 4. Ensure BAA (Business Associate Agreement) with all service providers
# 5. Use encrypted storage for all documents
# 6. Enable audit logging for all document access
#
# ============================================================================

# ----------------------------------------------------------------------------
# CORE WEBHOOK CONFIGURATION
# ----------------------------------------------------------------------------

# Webhook unique identifier
WEBHOOK_ID_MODULE_06=document-capture-v1

# CORS allowed origins (restrictive for PHI security)
ALLOWED_ORIGINS=https://yourdomain.com,https://app.yourdomain.com

# ----------------------------------------------------------------------------
# DOCUMENT INGESTION SOURCES
# ----------------------------------------------------------------------------

# Enable webhook ingestion (direct upload)
ENABLE_WEBHOOK_INGESTION=true

# Enable S3 bucket monitoring (automatic processing)
ENABLE_S3_INGESTION=true
S3_WATCH_BUCKET=aigent-document-uploads
S3_WATCH_PREFIX=incoming/

# Enable email ingestion (documents sent to email address)
ENABLE_EMAIL_INGESTION=true
INGESTION_EMAIL=documents@yourclinic.com

# ----------------------------------------------------------------------------
# OCR ENGINE CONFIGURATION
# ----------------------------------------------------------------------------

# OCR provider selection
# Options: mistral, gemini, abbyy, tesseract, textract
# Recommendation: mistral or gemini for medical documents (high accuracy)
OCR_PROVIDER=mistral

# ----------------------------------------------------------------------------
# MISTRAL OCR CONFIGURATION (If using Mistral)
# ----------------------------------------------------------------------------

# Mistral Credential ID
MISTRAL_CREDENTIAL_ID=19

# Mistral API Key (alternative to credential)
# MISTRAL_API_KEY=your-api-key

# Mistral model
MISTRAL_MODEL=mistral-large-2

# Mistral API timeout (milliseconds)
MISTRAL_TIMEOUT_MS=30000

# ----------------------------------------------------------------------------
# GOOGLE GEMINI CONFIGURATION (If using Gemini)
# ----------------------------------------------------------------------------

# Gemini Credential ID
GEMINI_CREDENTIAL_ID=20

# Gemini API Key (alternative)
# GEMINI_API_KEY=your-google-ai-api-key

# Gemini model
GEMINI_MODEL=gemini-1.5-pro

# Gemini API timeout (milliseconds)
GEMINI_TIMEOUT_MS=30000

# ----------------------------------------------------------------------------
# ABBYY CLOUD OCR (If using ABBYY)
# ----------------------------------------------------------------------------

# ABBYY Credential ID
ABBYY_CREDENTIAL_ID=21

# ABBYY Application ID
ABBYY_APP_ID=your-app-id

# ABBYY Password
# ABBYY_PASSWORD=your-password

# ABBYY processing profile
ABBYY_PROFILE=documentConversion

# ----------------------------------------------------------------------------
# TESSERACT OCR (If using Tesseract - Free, Lower Accuracy)
# ----------------------------------------------------------------------------

# Tesseract language
TESSERACT_LANG=eng

# Tesseract PSM (Page Segmentation Mode)
TESSERACT_PSM=3

# ----------------------------------------------------------------------------
# AWS TEXTRACT (If using AWS Textract)
# ----------------------------------------------------------------------------

# AWS Credential ID
AWS_CREDENTIAL_ID=17

# AWS Region
AWS_REGION=us-east-1

# Textract API timeout (milliseconds)
TEXTRACT_TIMEOUT_MS=60000

# ----------------------------------------------------------------------------
# DOCUMENT TYPE CLASSIFICATION
# ----------------------------------------------------------------------------

# Enable automatic document type detection
ENABLE_DOC_TYPE_DETECTION=true

# Supported document types (comma-separated)
# Options: lab_result, insurance_card, id_card, intake_form, consent_form, prescription, referral, invoice, other
SUPPORTED_DOC_TYPES=lab_result,insurance_card,id_card,intake_form,consent_form,prescription,referral

# Default document type (if detection fails)
DEFAULT_DOC_TYPE=other

# Classification confidence threshold (0.0-1.0)
# Documents below threshold marked as "other"
CLASSIFICATION_CONFIDENCE_THRESHOLD=0.7

# ----------------------------------------------------------------------------
# PHI REDACTION SETTINGS (HIPAA Critical)
# ----------------------------------------------------------------------------

# Enable PHI redaction in OCR text
# WARNING: Set to false ONLY if documents are stored in HIPAA-compliant system
ENABLE_PHI_REDACTION=true

# Redaction level (1-3)
# 1 = Preserve last 4 digits (SSN, MRN, IDs)
# 2 = Preserve last 2 digits
# 3 = Complete redaction (highest security)
REDACTION_LEVEL=1

# SSN redaction pattern
# XXX-XX-XXXX → XXX-XX-6789 (level 1)
REDACT_SSN=true

# Credit card redaction
# 4111-1111-1111-1111 → 4111-****-****-1111 (level 1)
REDACT_CREDIT_CARD=true

# Email masking
# john.doe@example.com → j***@example.com
REDACT_EMAIL=true

# Phone number masking
# +1-555-123-4567 → +1-555-***-4567
REDACT_PHONE=true

# MRN/Patient ID masking
# MRN123456 → ****3456 (level 1)
REDACT_MRN=true

# Driver's license redaction
REDACT_DRIVERS_LICENSE=true

# Passport number redaction
REDACT_PASSPORT=true

# ⚠️ REDACTION BEST PRACTICES:
# - Always enable redaction for logs and previews
# - Store original unredacted document in HIPAA-compliant encrypted storage
# - Audit all access to unredacted documents
# - Use redacted version for staff previews/search results

# ----------------------------------------------------------------------------
# DATA EXTRACTION SETTINGS
# ----------------------------------------------------------------------------

# Enable structured data extraction
# Extracts specific fields based on document type
ENABLE_DATA_EXTRACTION=true

# Lab result extraction fields
LAB_RESULT_FIELDS=test_name,result_value,result_unit,reference_range,result_status,test_date

# Insurance card extraction fields
INSURANCE_FIELDS=member_id,group_number,plan_name,payer_name,effective_date,copay

# ID card extraction fields
ID_CARD_FIELDS=full_name,date_of_birth,id_number,expiration_date,address

# Intake form extraction fields
INTAKE_FORM_FIELDS=full_name,date_of_birth,phone,email,address,emergency_contact

# Extraction confidence threshold (0.0-1.0)
# Fields below threshold marked as low_confidence
EXTRACTION_CONFIDENCE_THRESHOLD=0.8

# ----------------------------------------------------------------------------
# CRM INTEGRATION (HubSpot Default)
# ----------------------------------------------------------------------------

# HubSpot Credential ID
HUBSPOT_CREDENTIAL_ID=1

# HubSpot Credential Name
HUBSPOT_CREDENTIAL_NAME=HubSpot Production Account

# CRM document attachment
# Attach processed document to contact record
CRM_ATTACH_DOCUMENT=true

# CRM custom property mapping
# Map extracted fields to CRM properties
CRM_PROPERTY_MAPPING_ENABLED=true

# CRM Retry Configuration
CRM_RETRY_COUNT=3
CRM_RETRY_DELAY_MS=1000

# ----------------------------------------------------------------------------
# STORAGE CONFIGURATION
# ----------------------------------------------------------------------------

# Primary storage backend
# Options: s3, google_drive, sharepoint
STORAGE_BACKEND=s3

# AWS S3 Configuration
S3_STORAGE_BUCKET=aigent-documents-hipaa
S3_STORAGE_REGION=us-east-1
S3_STORAGE_PREFIX=processed/

# Enable S3 server-side encryption
S3_ENCRYPTION=AES256

# S3 KMS Key ID (if using aws:kms)
# S3_KMS_KEY_ID=arn:aws:kms:us-east-1:123456789012:key/abc-123

# Generate signed URLs for document access
S3_GENERATE_SIGNED_URL=true
S3_SIGNED_URL_EXPIRY=3600

# Google Drive Configuration (Alternative)
# GOOGLE_DRIVE_CREDENTIAL_ID=22
# GOOGLE_DRIVE_FOLDER_ID=your-folder-id

# SharePoint Configuration (Alternative)
# SHAREPOINT_CREDENTIAL_ID=23
# SHAREPOINT_SITE_ID=your-site-id
# SHAREPOINT_LIBRARY=Documents

# ⚠️ STORAGE COMPLIANCE:
# - Use encrypted storage (S3 with SSE, Google Drive Enterprise, SharePoint E5)
# - Enable versioning (protects against accidental deletion/modification)
# - Restrict access via IAM/permissions (least privilege)
# - Enable audit logging (track all document access)
# - Ensure BAA with storage provider

# ----------------------------------------------------------------------------
# METADATA LOGGING (Google Sheets / Airtable)
# ----------------------------------------------------------------------------

# Google Sheets Credential ID
GOOGLE_SHEETS_CREDENTIAL_ID=6

# Spreadsheet ID
GOOGLE_SHEET_ID=your-spreadsheet-id

# Sheet tab name for document log
GOOGLE_SHEET_TAB_DOCUMENTS=Documents

# Log redacted preview (first 200 chars of OCR text)
LOG_REDACTED_PREVIEW=true

# Airtable Configuration (Alternative)
# AIRTABLE_CREDENTIAL_ID=16
# AIRTABLE_BASE_ID=your-base-id
# AIRTABLE_TABLE_NAME=Documents

# ----------------------------------------------------------------------------
# NOTIFICATION SETTINGS
# ----------------------------------------------------------------------------

# Enable notifications on document processing completion
ENABLE_NOTIFICATIONS=true

# Slack notifications
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/T.../B.../XXX...
SLACK_CHANNEL=#documents

# Email notifications (staff)
STAFF_NOTIFICATION_EMAIL=staff@yourclinic.com

# SMS notifications (urgent documents)
ENABLE_SMS_NOTIFICATIONS=false

# Twilio Credential ID (if SMS enabled)
# TWILIO_CREDENTIAL_ID=8

# ----------------------------------------------------------------------------
# DOCUMENT VALIDATION
# ----------------------------------------------------------------------------

# Maximum file size (bytes)
# Default: 10MB
MAX_FILE_SIZE_BYTES=10485760

# Allowed file types (comma-separated)
ALLOWED_FILE_TYPES=pdf,png,jpg,jpeg,tiff,heic

# Minimum image resolution (DPI)
# Lower resolution may result in poor OCR accuracy
MIN_IMAGE_DPI=150

# Image preprocessing
# Enhance image quality before OCR
ENABLE_IMAGE_PREPROCESSING=true

# ⚠️ FILE VALIDATION:
# - Block executable files (.exe, .bat, .sh)
# - Scan for malware (integrate with antivirus API)
# - Validate file headers (prevent extension spoofing)

# ----------------------------------------------------------------------------
# PERFORMANCE TUNING
# ----------------------------------------------------------------------------

# Workflow execution timeout (milliseconds)
# OCR can take longer than other modules
WORKFLOW_TIMEOUT_MS=180000

# Maximum parallel executions
MAX_PARALLEL_EXECUTIONS=3

# API timeout configurations (milliseconds)
OCR_API_TIMEOUT_MS=30000
STORAGE_API_TIMEOUT_MS=15000
CRM_API_TIMEOUT_MS=10000

# Retry configuration
OCR_RETRY_COUNT=2
OCR_RETRY_DELAY_MS=2000
STORAGE_RETRY_COUNT=3
STORAGE_RETRY_DELAY_MS=1000

# Target execution time (milliseconds)
# Module 06 target: <5000ms (OCR is computationally intensive)
TARGET_EXECUTION_TIME_MS=5000

# ----------------------------------------------------------------------------
# OBSERVABILITY & MONITORING
# ----------------------------------------------------------------------------

# Enable debug mode
DEBUG_MODE=false

# Save execution data
SAVE_EXECUTION_DATA=all

# Support email
SUPPORT_EMAIL=support@yourclinic.com

# Workflow version
WORKFLOW_VERSION=1.1.0-enhanced

# Enable performance tracking
ENABLE_PERFORMANCE_TRACKING=true

# ----------------------------------------------------------------------------
# SECURITY & COMPLIANCE (HIPAA CRITICAL)
# ----------------------------------------------------------------------------

# HIPAA mode
HIPAA_MODE=true

# Encryption at rest
ENABLE_ENCRYPTION_AT_REST=true

# Enable audit logging
# Log all document uploads, access, exports
AUDIT_LOG_ENABLED=true

# Module 09 (Audit) webhook URL
MODULE_09_AUDIT_WEBHOOK_URL=https://n8n.yourclinic.com/webhook/aigent-audit-log

# Data retention period (days)
# HIPAA: 6 years minimum (2190 days)
DATA_RETENTION_DAYS=2555

# ⚠️ HIPAA COMPLIANCE CHECKLIST:
# [ ] BAA signed with OCR provider (Mistral/Gemini/ABBYY/AWS)
# [ ] BAA signed with storage provider (AWS/Google/Microsoft)
# [ ] Encryption at rest enabled
# [ ] Encryption in transit (HTTPS/TLS)
# [ ] Access controls configured (IAM/RBAC)
# [ ] Audit logging enabled (all PHI access)
# [ ] PHI redaction enabled for logs
# [ ] Document retention policy configured
# [ ] Breach notification plan documented

# ----------------------------------------------------------------------------
# INTEGRATION WITH OTHER MODULES
# ----------------------------------------------------------------------------

# Module 01 (Lead Capture) webhook (for attaching documents to leads)
MODULE_01_WEBHOOK_URL=https://n8n.yourclinic.com/webhook/intake-lead

# Module 03 (Telehealth) webhook (for session-related documents)
MODULE_03_WEBHOOK_URL=https://n8n.yourclinic.com/webhook/telehealth-session

# Module 04 (Billing) webhook (for invoices/receipts)
MODULE_04_WEBHOOK_URL=https://n8n.yourclinic.com/webhook/billing-payment

# Module 07 (Analytics) ingestion
MODULE_07_ANALYTICS_API=https://n8n.yourclinic.com/webhook/07-analytics-ingest

# ----------------------------------------------------------------------------
# ADVANCED FEATURES (Future Enhancements)
# ----------------------------------------------------------------------------

# Enable AI summarization
# Generate human-readable summary of lab results
ENABLE_AI_SUMMARIZATION=false

# AI summarization model
# AI_SUMMARY_MODEL=gpt-4

# Enable document comparison
# Compare multiple lab results over time
ENABLE_DOCUMENT_COMPARISON=false

# Enable translation
# Translate documents to patient's preferred language
ENABLE_TRANSLATION=false

# Translation target languages (comma-separated)
# TRANSLATION_LANGUAGES=es,zh,ar,vi

# ============================================================================
# END OF CONFIGURATION
# ============================================================================
#
# SECURITY CHECKLIST:
# [ ] OCR provider configured with BAA signed
# [ ] Storage backend configured with encryption
# [ ] PHI redaction enabled (ENABLE_PHI_REDACTION=true)
# [ ] File validation configured (type, size, DPI)
# [ ] Access controls configured (storage permissions)
# [ ] Audit logging enabled (MODULE_09_AUDIT_WEBHOOK_URL)
# [ ] Retention policy configured (DATA_RETENTION_DAYS)
# [ ] Notifications configured (Slack, email)
# [ ] CRM integration tested
# [ ] Document type classification tested
#
# TESTING CHECKLIST:
# [ ] Test document upload (PDF, PNG, JPG)
# [ ] Test OCR accuracy (various document types)
# [ ] Test PHI redaction (SSN, CC, email, phone, MRN)
# [ ] Test document type classification
# [ ] Test data extraction (lab results, insurance cards, IDs)
# [ ] Test storage upload (S3/Drive/SharePoint)
# [ ] Test CRM attachment
# [ ] Test notifications (Slack, email)
# [ ] Test with different image qualities (low/high DPI)
# [ ] Test error handling (invalid file types, oversized files)
# [ ] Verify no PHI in logs or notifications
# [ ] Test signed URL generation
# [ ] Test with multi-page PDFs
# [ ] Test with handwritten documents
#
# MONITORING CHECKLIST:
# [ ] Monitor OCR success rate (>95%)
# [ ] Monitor execution time (<5000ms P95)
# [ ] Monitor file upload success rate
# [ ] Monitor classification accuracy
# [ ] Monitor extraction accuracy
# [ ] Track documents by type (lab results, IDs, etc.)
# [ ] Monitor storage backend health
# [ ] Review OCR errors (poor image quality, unsupported formats)
# [ ] Track PHI redaction effectiveness
#
# For support: support@aigent.company
# Documentation: https://docs.aigent.company/templates/module-06-enhanced
# ============================================================================
