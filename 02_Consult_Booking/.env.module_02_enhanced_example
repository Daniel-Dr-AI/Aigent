# ============================================================================
# Aigent Module 02 - Enhanced Consult Booking & Scheduling
# Environment Variables Template
# Version: 1.1.0-enhanced
# ============================================================================
#
# INSTRUCTIONS:
# 1. Copy this file to your n8n environment configuration
# 2. Replace all placeholder values with your actual credentials/settings
# 3. NEVER commit the actual .env file to version control
# 4. For Docker: Add to docker-compose.yml under 'environment' section
# 5. For n8n Cloud: Add via Settings â†’ Environments
# 6. For Self-hosted: Export to shell or use .env file with docker-compose
#
# ============================================================================

# ----------------------------------------------------------------------------
# CORE WEBHOOK CONFIGURATION
# ----------------------------------------------------------------------------

# Webhook unique identifier (optional - n8n auto-generates if not set)
WEBHOOK_ID_MODULE_02=consult-booking-v1

# CORS allowed origins (comma-separated)
# Development: Use '*' to allow all origins
# Production: Specify exact domains for security
ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com
# Example for development:
# ALLOWED_ORIGINS=*

# ----------------------------------------------------------------------------
# SCHEDULING SYSTEM INTEGRATION (Cal.com / Acuity / SimplyBook)
# ----------------------------------------------------------------------------

# Scheduling API Base URL
# Cal.com: https://api.cal.com/v1
# Acuity: https://acuityscheduling.com/api/v1
# SimplyBook: https://user-api.simplybook.me
SCHEDULING_API_BASE_URL=https://api.cal.com/v1

# Scheduling system credential ID (from n8n Credentials page)
SCHEDULING_CREDENTIAL_ID=3

# Scheduling system credential name (must match name in n8n)
SCHEDULING_CREDENTIAL_NAME=Cal.com Production API

# Event Type ID (service/appointment type identifier)
# Cal.com: Event type ID from dashboard
# Acuity: Appointment type ID
# SimplyBook: Service ID
SCHEDULING_EVENT_TYPE_ID=123456

# Scheduling system provider name (for metadata)
SCHEDULING_PROVIDER_NAME=Cal.com

# Public scheduling base URL (for reschedule links)
SCHEDULING_BASE_URL=https://cal.yourclinic.com

# Default appointment duration (minutes) if not specified by scheduling system
DEFAULT_APPOINTMENT_DURATION=30

# ----------------------------------------------------------------------------
# CLINIC CONFIGURATION
# ----------------------------------------------------------------------------

# Clinic timezone (IANA timezone identifier)
# Examples: America/New_York, America/Los_Angeles, Europe/London
CLINIC_TIMEZONE=America/New_York

# Clinic name (used in SMS and email confirmations)
CLINIC_NAME=Your Clinic Name

# Clinic phone number (displayed to patients)
CLINIC_PHONE=+1-555-123-4567

# Clinic email (displayed to patients)
CLINIC_EMAIL=info@yourclinic.com

# Clinic physical address (optional - used in email confirmations)
CLINIC_ADDRESS=123 Main St, Suite 100, City, ST 12345

# Default language for communications
DEFAULT_LANGUAGE=en

# ----------------------------------------------------------------------------
# CRM INTEGRATION (HubSpot Default)
# ----------------------------------------------------------------------------

# HubSpot Credential ID (from n8n Credentials page)
HUBSPOT_CREDENTIAL_ID=1

# HubSpot Credential Name (must match name in n8n)
HUBSPOT_CREDENTIAL_NAME=HubSpot Production Account

# CRM Retry Configuration (NEW in v1.1)
# Number of retry attempts for CRM API failures
CRM_RETRY_COUNT=3

# Delay between retry attempts in milliseconds
CRM_RETRY_DELAY_MS=1000

# ----------------------------------------------------------------------------
# ALTERNATE CRM EXAMPLES (Comment out HubSpot, uncomment one below)
# ----------------------------------------------------------------------------

# Salesforce Configuration
# SALESFORCE_CREDENTIAL_ID=2
# SALESFORCE_CREDENTIAL_NAME=Salesforce Production

# Zoho CRM Configuration
# ZOHO_CREDENTIAL_ID=3
# ZOHO_CREDENTIAL_NAME=Zoho CRM Account

# ----------------------------------------------------------------------------
# SMS CONFIRMATION (Twilio)
# ----------------------------------------------------------------------------

# Twilio Credential ID (from n8n Credentials page)
TWILIO_CREDENTIAL_ID=8

# Twilio Credential Name (must match name in n8n)
TWILIO_CREDENTIAL_NAME=Twilio SMS Production

# Twilio phone number (clinic's SMS-enabled number)
TWILIO_FROM_NUMBER=+15551234567

# SMS Retry Configuration (NEW in v1.1)
SMS_RETRY_COUNT=2
SMS_RETRY_DELAY_MS=500

# ----------------------------------------------------------------------------
# EMAIL CONFIRMATION (SendGrid)
# ----------------------------------------------------------------------------

# SendGrid Credential ID (from n8n Credentials page)
SENDGRID_CREDENTIAL_ID=11

# SendGrid Credential Name (must match name in n8n)
SENDGRID_CREDENTIAL_NAME=SendGrid Production API

# SendGrid from email (must be verified in SendGrid)
SENDGRID_FROM_EMAIL=noreply@yourclinic.com

# SendGrid BCC email (optional - copy clinic staff on all confirmations)
SENDGRID_BCC_EMAIL=appointments@yourclinic.com

# Enable calendar invite attachment (.ics file)
ENABLE_CALENDAR_ATTACHMENT=true

# Email Retry Configuration (NEW in v1.1)
EMAIL_RETRY_COUNT=2
EMAIL_RETRY_DELAY_MS=500

# ----------------------------------------------------------------------------
# BRANDING & CUSTOMIZATION
# ----------------------------------------------------------------------------

# Brand primary color (hex code for email template)
BRAND_PRIMARY_COLOR=#4F46E5

# Enable unsubscribe link in emails (for marketing compliance)
ENABLE_UNSUBSCRIBE=false

# ----------------------------------------------------------------------------
# ALTERNATE EMAIL PROVIDERS
# ----------------------------------------------------------------------------

# Mailgun Configuration
# MAILGUN_CREDENTIAL_ID=12
# MAILGUN_FROM_EMAIL=noreply@yourclinic.com

# AWS SES Configuration
# AWS_SES_CREDENTIAL_ID=13
# AWS_SES_FROM_EMAIL=noreply@yourclinic.com

# ----------------------------------------------------------------------------
# ENHANCED FEATURES (NEW in v1.1)
# ----------------------------------------------------------------------------

# Enable duplicate booking prevention (5-minute window check)
# Requires Redis or CRM query implementation
ENABLE_DUPLICATE_CHECK=false

# Duplicate check window in minutes
DUPLICATE_CHECK_WINDOW_MINUTES=5

# Enable timezone auto-detection from client IP
# Requires ipapi.co or similar geolocation service
ENABLE_TIMEZONE_DETECTION=true

# Enable smart slot recommendation based on historical no-show patterns
# Uses hardcoded no-show rates by hour (production: integrate with Module 07 analytics)
ENABLE_SMART_SLOT_RECOMMENDATION=true

# Enable phone normalization (digits-only storage)
ENABLE_PHONE_NORMALIZATION=true

# Enable execution time tracking
ENABLE_PERFORMANCE_TRACKING=true

# ----------------------------------------------------------------------------
# OBSERVABILITY & MONITORING (NEW in v1.1)
# ----------------------------------------------------------------------------

# Enable debug mode (logs additional details)
DEBUG_MODE=false

# Save execution data for all runs (for analysis)
# Options: all, none, onlyOnError
SAVE_EXECUTION_DATA=all

# Support email displayed in error responses
SUPPORT_EMAIL=support@yourclinic.com

# ----------------------------------------------------------------------------
# GLOBAL ERROR HANDLING
# ----------------------------------------------------------------------------

# Error workflow ID (optional - for centralized error handling)
# Leave empty to use inline error handling
ERROR_WORKFLOW_ID=

# ----------------------------------------------------------------------------
# N8N INSTANCE CONFIGURATION
# ----------------------------------------------------------------------------

# n8n instance identifier (for multi-instance deployments)
N8N_INSTANCE_ID=production-001

# Workflow version (auto-tracked in enhanced version)
WORKFLOW_VERSION=1.1.0-enhanced

# Timezone for timestamp operations
TZ=America/New_York

# Environment identifier (development, staging, production)
NODE_ENV=production

# ----------------------------------------------------------------------------
# SECURITY & COMPLIANCE
# ----------------------------------------------------------------------------

# HIPAA mode (enables additional security checks)
# Note: Module 02 is PHI-safe by design (no medical data collected)
HIPAA_MODE=false

# Data retention period in days
# HIPAA compliance: 7 years = 2555 days
DATA_RETENTION_DAYS=2555

# Enable audit logging
AUDIT_LOG_ENABLED=true

# ----------------------------------------------------------------------------
# PERFORMANCE TUNING
# ----------------------------------------------------------------------------

# Workflow execution timeout (milliseconds)
# Default: 120000 (2 minutes)
WORKFLOW_TIMEOUT_MS=120000

# Maximum parallel executions (for high-volume scenarios)
MAX_PARALLEL_EXECUTIONS=10

# API timeout configurations (milliseconds)
SCHEDULING_API_TIMEOUT_MS=10000
CRM_API_TIMEOUT_MS=10000
SMS_API_TIMEOUT_MS=5000
EMAIL_API_TIMEOUT_MS=5000

# ----------------------------------------------------------------------------
# SMART SLOT RECOMMENDATION CONFIGURATION (NEW in v1.1)
# ----------------------------------------------------------------------------

# Historical no-show rates by hour of day (0-23)
# Format: comma-separated values, one per hour starting at 8am
# Example: 0.15,0.12,0.10 = 8am: 15% no-show, 9am: 12%, 10am: 10%
# Production: Replace with real data from Module 07 analytics
NO_SHOW_RATES_BY_HOUR=0.15,0.12,0.10,0.08,0.20,0.18,0.08,0.07,0.10,0.15

# Minimum recommendation score (0-1) for slot suggestion
# Slots below this score won't be recommended (unless patient explicitly requests)
MIN_RECOMMENDATION_SCORE=0.80

# ----------------------------------------------------------------------------
# INTEGRATION WITH OTHER MODULES
# ----------------------------------------------------------------------------

# Module 01 (Lead Capture) webhook URL (optional - for triggering from Module 01)
MODULE_01_WEBHOOK_URL=https://n8n.yourclinic.com/webhook/01-intake-lead

# Module 03 (Telehealth Session) webhook URL (optional - for triggering to Module 03)
MODULE_03_WEBHOOK_URL=https://n8n.yourclinic.com/webhook/03-telehealth-session

# Module 07 (Analytics) data store (optional - for no-show rate updates)
MODULE_07_ANALYTICS_API=https://n8n.yourclinic.com/webhook/07-analytics-ingest

# Module 09 (Audit) webhook URL (optional - for audit logging)
MODULE_09_AUDIT_WEBHOOK_URL=https://n8n.yourclinic.com/webhook/09-compliance-audit

# ----------------------------------------------------------------------------
# WAITLIST CONFIGURATION (FUTURE ENHANCEMENT)
# ----------------------------------------------------------------------------

# Enable waitlist when no slots available
ENABLE_WAITLIST=false

# Waitlist notification webhook (for alerting patients when slots open)
WAITLIST_NOTIFICATION_WEBHOOK=

# ============================================================================
# END OF CONFIGURATION
# ============================================================================
#
# VALIDATION CHECKLIST:
# [ ] All credential IDs match your n8n instance
# [ ] Scheduling API tested with curl/Postman
# [ ] CORS origins match your frontend domains
# [ ] Twilio phone number is SMS-enabled
# [ ] SendGrid from email is verified
# [ ] Clinic timezone is correct
# [ ] Webhook URLs are reachable
# [ ] Retry counts set based on reliability requirements
# [ ] Smart slot recommendation enabled (if desired)
# [ ] Performance tracking enabled
#
# SECURITY CHECKLIST:
# [ ] No credentials hardcoded in workflow JSON
# [ ] .env file added to .gitignore
# [ ] Production ALLOWED_ORIGINS is restrictive (no *)
# [ ] Credentials use OAuth2 where possible (vs API keys)
# [ ] Error messages don't expose sensitive internal details
# [ ] API timeouts configured appropriately
# [ ] Retry logic won't cause runaway executions
#
# TESTING CHECKLIST:
# [ ] Test booking with valid data
# [ ] Test validation errors (missing fields, invalid email, past date)
# [ ] Test no-availability scenario
# [ ] Test SMS delivery (check phone receives message)
# [ ] Test email delivery (check inbox + spam folder)
# [ ] Test CRM update (verify contact record updated)
# [ ] Test duplicate prevention (if enabled)
# [ ] Test timezone handling (book from different timezones)
# [ ] Test smart slot recommendation (verify optimal slot selected)
# [ ] Test execution time tracking (check metadata in response)
#
# For support: support@aigent.company
# Documentation: https://docs.aigent.company/templates/module-02-enhanced
# ============================================================================
